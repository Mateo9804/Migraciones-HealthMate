id_linedcto,id_tabla,query,consulta,datasource
107,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
107,20,qrycolabora,"select colabora.snombrecol,colabora.snifcol,colabora.sdomiciliocol,colabora.spoblacioncol,colabora.scodpostalcol,colabora.sprovinciacol,colabora.stelefonocol,colabora.telefono2,colabora.smovilcol,colabora.sfaxcol,colabora.email,colabora.pagweb from colabora where codcolab=:codcolab",
107,21,qrycontacto,"select contacto.nombre,contacto.telefono1,contacto.email1 from colabora inner join contactlin on colabora.codcolab = contactlin.icodcolab inner join contacto on contactlin.icodcontacto = contacto.codcontacto where colabora.codcolab=:codcolab",
108,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
108,21,qrycontacto,"select contacto.nombre,contacto.nif,contacto.domicilio,contacto.poblacion,contacto.codpostal,contacto.provincia,contacto.telefono1,contacto.telefono2,contacto.movil,contacto.fax,contacto.email1,contacto.pagweb from contacto where codcontacto=:codcontacto",
127,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
127,21,qrycontacto,"select contacto.nombre,contacto.telefono1,contacto.email1 from organism inner join contactlin on organism.codorgan= contactlin.icodorgan inner join contacto on contactlin.icodcontacto = contacto.codcontacto where organism.codorgan=:codorgan",
127,29,qryorganism,"select organism.nombre,organism.cif,organism.domicilio,organism.poblacion,organism.codpostal,organism.provincia,organism.telefono,organism.telefono2,organism.telefono3,organism.fax,organism.email,organism.pagweb from organism where codorgan=:codorgan",
184,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
184,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
184,24,qryexp,"select expedien.dfechaalta,expedien.expediente,expedien.iyear,expedien.descripcion,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
184,37,qrysubusu,select subusu.nombre from subusu  left join expedien on subusu.icodsubusu=expedien.codsubusu where inumexp=:inumexp and iyear=:iyear,
185,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
185,4,qrycli,"select clientes.snombrecli,clientes.stelefonocli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
185,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.dfechaalta,expedien.descripcion,expedien.srefabogado,expedien.srefcliente,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
185,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
185,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,segexp.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
185,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
185,62,QryTipoAsun,select tipoasun.tipoasunto from tipoasun  left join expedien on tipoasun.codigo=expedien.itipoasunto where inumexp=:inumexp and iyear=:iyear,
187,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
187,4,qrycli,"select clientes.snombrecli,clientes.stelefonocli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
187,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.dfechaalta,expedien.descripcion,expedien.srefabogado,expedien.srefcliente,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
187,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
187,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
187,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
187,62,QryTipoAsun,select tipoasun.tipoasunto from tipoasun  left join expedien on tipoasun.codigo=expedien.itipoasunto where inumexp=:inumexp and iyear=:iyear,
188,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
188,4,qrycli,"select clientes.snombrecli,clientes.stelefonocli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
188,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.dfechaalta,expedien.descripcion,expedien.srefabogado,expedien.srefcliente,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
188,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
188,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
188,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
188,62,QryTipoAsun,select tipoasun.tipoasunto from tipoasun  left join expedien on tipoasun.codigo=expedien.itipoasunto where inumexp=:inumexp and iyear=:iyear,
190,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
190,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
190,24,qryexp,"select expedien.dfechaalta,expedien.expediente,expedien.iyear,expedien.descripcion,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
190,37,qrysubusu,select subusu.nombre from subusu  left join expedien on subusu.icodsubusu=expedien.codsubusu where inumexp=:inumexp and iyear=:iyear,
194,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
194,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
194,35,qryseg,"select segcli.dfechaact,segcli.sactuacion,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' +DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' +DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segcli left join subusu on segcli.subusu=subusu.icodsubusu where icodcli=:icodcli",
195,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
195,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
195,35,qryseg,"select segcli.dfechaact,segcli.sactuacion,segcli.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' +DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' +DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segcli left join subusu on segcli.subusu=subusu.icodsubusu where icodcli=:icodcli",
197,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
197,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
199,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
199,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
199,35,qryseg,"select segcli.dfechaact,segcli.sactuacion,segcli.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' +DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' +DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segcli left join subusu on segcli.subusu=subusu.icodsubusu where icodcli=:icodcli",
199,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
200,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
200,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
200,35,qryseg,"select segcli.dfechaact,segcli.sactuacion,segcli.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' +DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' +DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segcli left join subusu on segcli.subusu=subusu.icodsubusu where icodcli=:icodcli",
200,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
201,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
201,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.stelefonocli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
201,35,qryseg,"select segcli.dfechaact,segcli.sactuacion,segcli.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' +DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' +DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segcli left join subusu on segcli.subusu=subusu.icodsubusu where icodcli=:icodcli",
201,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
202,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
202,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
202,69,qrycliultactu,"select top 1 segcli.sactuacion, segcli.dfechaact, segcli.dfechanotificacion, DATENAME(hh, horainiact) + ':' +DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' +DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact from segcli where segcli.icodcli=:icodcli order by dfechaact desc,linea desc",
204,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
204,4,qrycli,"select clientes.codigo,clientes.snombrecli,clientes.stelefonocli,clientes.fechaalta,clientes.snifcli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
204,21,qrycontact,"select contacto.nombre,contacto.telefono1 from clientes inner join contactlin on clientes.icodcli = contactlin.icodcli inner join contacto on contactlin.icodcontacto = contacto.codcontacto where clientes.icodcli=:icodcli",
204,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
205,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
205,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,clientes.codigo,clientes.fechaalta,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
205,21,qrycontact,"select contacto.nombre,contacto.telefono1,contacto.email1 from clientes inner join contactlin on clientes.icodcli = contactlin.icodcli inner join contacto on contactlin.icodcontacto = contacto.codcontacto where clientes.icodcli=:icodcli",
205,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
206,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
206,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,clientes.codigo,clientes.fechaalta,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
206,21,qrycontact,"select contacto.nombre,contacto.telefono1,contacto.email1 from clientes inner join contactlin on clientes.icodcli = contactlin.icodcli inner join contacto on contactlin.icodcontacto = contacto.codcontacto where clientes.icodcli=:icodcli",
206,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
209,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
209,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
209,36,qrycliadjun,"select cliadjun.fecha,cliadjun.imagen,cliadjun.descripcion from cliadjun where cliadjun.icodcli=:icodcli",
210,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
210,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,clientes.codigo,clientes.fechaalta,clientes.concepto1gr1,clientes.importe1gr1,clientes.servicio1gr1,clientes.importeanual1gr1,clientes.concepto2gr1,clientes.importe2gr1,clientes.servicio2gr1,clientes.importeanual2gr1,clientes.concepto3gr1,clientes.importe3gr1,clientes.servicio3gr1,clientes.importeanual3gr1,clientes.concepto4gr1,clientes.importe4gr1,clientes.servicio4gr1,clientes.importeanual4gr1,clientes.concepto5gr1,clientes.importe5gr1,clientes.servicio5gr1,clientes.importeanual5gr1,clientes.concepto6gr1,clientes.importe6gr1,clientes.servicio6gr1,clientes.importeanual6gr1,clientes.totalarea1,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
210,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
214,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
214,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
214,35,qryseg,"select segcli.dfechaact,segcli.sactuacion,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' +DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' +DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segcli left join subusu on segcli.subusu=subusu.icodsubusu where icodcli=:icodcli",
215,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
215,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
215,35,qryseg,"select segcli.dfechaact,segcli.sactuacion,segcli.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' +DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' +DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segcli left join subusu on segcli.subusu=subusu.icodsubusu where icodcli=:icodcli",
215,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
216,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
216,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,clientes.ftotalbaseimp,clientes.ftotaliva,clientes.ftotalirpf,clientes.ftotaleuro,clientes.ftotalcobro,clientes.fsaldofinal,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
216,57,qrycue,"select cuencli.dfecha,cuencli.sDescripcion,cuencli.fentradaseuro,cuencli.fsalidaseuro from cuencli where icodcli=:icodcli",
222,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
222,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.descripcion,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
222,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,segexp.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
222,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
225,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
225,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
225,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,segexp.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
225,37,qrysubusu,select subusu.nombre from subusu  left join expedien on subusu.icodsubusu=expedien.codsubusu where inumexp=:inumexp and iyear=:iyear,
226,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
226,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
226,24,qryexp,"select expedien.dfechacierre,expedien.expediente,expedien.iyear,expedien.descripcion,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
226,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,segexp.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
226,37,qrysubusu,select subusu.nombre from subusu  left join expedien on subusu.icodsubusu=expedien.codsubusu where inumexp=:inumexp and iyear=:iyear,
227,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
227,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
227,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,segexp.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
227,37,qrysubusu,select subusu.nombre from subusu  left join expedien on subusu.icodsubusu=expedien.codsubusu where inumexp=:inumexp and iyear=:iyear,
229,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
229,4,qrycli,"select clientes.snombrecli,clientes.stelefonocli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
229,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.dfechaalta,expedien.srefabogado,expedien.srefcliente,expedien.descripcion,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
229,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
229,37,qrysubusu,select subusu.nombre from subusu  left join expedien on subusu.icodsubusu=expedien.codsubusu where inumexp=:inumexp and iyear=:iyear,
230,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
230,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
230,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.dfechaalta,expedien.descripcion,expedien.srefabogado,expedien.srefcliente,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
230,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
230,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
230,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
230,62,QryTipoAsun,select tipoasun.tipoasunto from tipoasun  left join expedien on tipoasun.codigo=expedien.itipoasunto where inumexp=:inumexp and iyear=:iyear,
242,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
242,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
243,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
243,4,qrycli,"select clientes.codigo,clientes.snombrecli,clientes.stelefonocli,clientes.fechaalta,clientes.snifcli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
243,21,qrycontact,"select contacto.nombre,contacto.telefono1 from clientes inner join contactlin on clientes.icodcli = contactlin.icodcli inner join contacto on contactlin.icodcontacto = contacto.codcontacto where clientes.icodcli=:icodcli",
243,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
244,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
244,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,clientes.codigo,clientes.fechaalta,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
244,21,qrycontact,"select contacto.nombre,contacto.telefono1,contacto.email1 from clientes inner join contactlin on clientes.icodcli = contactlin.icodcli inner join contacto on contactlin.icodcontacto = contacto.codcontacto where clientes.icodcli=:icodcli",
244,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
245,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
245,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,clientes.codigo,clientes.fechaalta,clientes.notas,clientes.notas2,clientes.notas3,clientes.notas4,clientes.notas5,clientes.notas6,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
245,21,qrycontact,"select contacto.nombre,contacto.telefono1,contacto.email1 from clientes inner join contactlin on clientes.icodcli = contactlin.icodcli inner join contacto on contactlin.icodcontacto = contacto.codcontacto where clientes.icodcli=:icodcli",
245,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
246,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
246,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
246,36,qrycliadjun,"select cliadjun.fecha,cliadjun.imagen,cliadjun.descripcion from cliadjun where cliadjun.icodcli=:icodcli",
247,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
247,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,clientes.codigo,clientes.fechaalta,clientes.concepto1gr1,clientes.importe1gr1,clientes.servicio1gr1,clientes.importeanual1gr1,clientes.concepto2gr1,clientes.importe2gr1,clientes.servicio2gr1,clientes.importeanual2gr1,clientes.concepto3gr1,clientes.importe3gr1,clientes.servicio3gr1,clientes.importeanual3gr1,clientes.concepto4gr1,clientes.importe4gr1,clientes.servicio4gr1,clientes.importeanual4gr1,clientes.concepto5gr1,clientes.importe5gr1,clientes.servicio5gr1,clientes.importeanual5gr1,clientes.concepto6gr1,clientes.importe6gr1,clientes.servicio6gr1,clientes.importeanual6gr1,clientes.totalarea1,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
247,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
248,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
248,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
248,35,qryseg,"select segcli.dfechaact,segcli.sactuacion,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' +DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' +DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segcli left join subusu on segcli.subusu=subusu.icodsubusu where icodcli=:icodcli",
249,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
249,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
249,35,qryseg,"select segcli.dfechaact,segcli.sactuacion,segcli.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' +DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' +DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segcli left join subusu on segcli.subusu=subusu.icodsubusu where icodcli=:icodcli",
249,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
250,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
250,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,clientes.ftotalbaseimp,clientes.ftotaliva,clientes.ftotalirpf,clientes.ftotaleuro,clientes.ftotalcobro,clientes.fsaldofinal,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from clientes where icodcli=:icodcli",
250,57,qrycue,"select cuencli.dfecha,cuencli.sDescripcion,cuencli.fentradaseuro,cuencli.fsalidaseuro from cuencli where icodcli=:icodcli",
254,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
254,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
254,24,qryexp,"select expedien.dfechaalta,expedien.expediente,expedien.iyear,expedien.descripcion,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
254,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,segexp.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
254,37,qrysubusu,select subusu.nombre from subusu  left join expedien on subusu.icodsubusu=expedien.codsubusu where inumexp=:inumexp and iyear=:iyear,
255,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
255,4,qrycli,"select clientes.snombrecli,clientes.stelefonocli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
255,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.dfechaalta,expedien.descripcion,expedien.srefabogado,expedien.srefcliente,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
255,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
255,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,segexp.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
255,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
255,62,QryTipoAsun,select tipoasun.tipoasunto from tipoasun  left join expedien on tipoasun.codigo=expedien.itipoasunto where inumexp=:inumexp and iyear=:iyear,
256,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
256,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
256,24,qryexp,"select expedien.expediente,expedien.descripcion,expedien.ultActuFechaAct,expedien.ultactu,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
257,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
257,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
257,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,segexp.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
257,37,qrysubusu,select subusu.nombre from subusu  left join expedien on subusu.icodsubusu=expedien.codsubusu where inumexp=:inumexp and iyear=:iyear,
258,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
258,4,qrycli,"select clientes.snombrecli,clientes.stelefonocli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
258,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.dfechaalta,expedien.descripcion,expedien.srefabogado,expedien.srefcliente,expedien.ultActuFechaAct,expedien.ultactu,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
258,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
258,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
258,62,QryTipoAsun,select tipoasun.tipoasunto from tipoasun  left join expedien on tipoasun.codigo=expedien.itipoasunto where inumexp=:inumexp and iyear=:iyear,
259,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
259,4,qrycli,"select clientes.snombrecli,clientes.stelefonocli,clientes.email,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
259,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.dfechaalta,expedien.descripcion,expedien.srefabogado,expedien.srefcliente,expedien.notas,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
259,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
259,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
259,62,QryTipoAsun,select tipoasun.tipoasunto from tipoasun  left join expedien on tipoasun.codigo=expedien.itipoasunto where inumexp=:inumexp and iyear=:iyear,
260,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
260,4,qrycli,"select clientes.snombrecli,clientes.stelefonocli,clientes.email,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
260,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.dfechaalta,expedien.descripcion,expedien.srefabogado,expedien.srefcliente,expedien.notas,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
260,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
260,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
260,62,QryTipoAsun,select tipoasun.tipoasunto from tipoasun  left join expedien on tipoasun.codigo=expedien.itipoasunto where inumexp=:inumexp and iyear=:iyear,
261,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
261,4,qrycli,"select clientes.snombrecli,clientes.stelefonocli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
261,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.dfechaalta,expedien.descripcion,expedien.srefabogado,expedien.srefcliente,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
261,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
261,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
261,62,QryTipoAsun,select tipoasun.tipoasunto from tipoasun  left join expedien on tipoasun.codigo=expedien.itipoasunto where inumexp=:inumexp and iyear=:iyear,
261,63,qryexpadjun,"select expadjun.Fecha,expadjun.Imagen from expadjun where expadjun.inumexp=:inumexp and expadjun.iyear=:iyear",
262,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
262,4,qrycli,"select clientes.snombrecli,clientes.stelefonocli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
262,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.dfechaalta,expedien.descripcion,expedien.srefabogado,expedien.srefcliente,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
262,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
262,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
262,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
262,62,QryTipoAsun,select tipoasun.tipoasunto from tipoasun  left join expedien on tipoasun.codigo=expedien.itipoasunto where inumexp=:inumexp and iyear=:iyear,
263,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
263,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.descripcion,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
263,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
263,27,qryseg,"select segexp.dfechaact,segexp.sactuacion,segexp.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' + DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' + DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segexp left join subusu on segexp.subusu=subusu.icodsubusu where inumexp=:inumexp and iyear=:iyear",
263,37,qrysubusu,select subusu.nombre from subusu  left join expedien on subusu.icodsubusu=expedien.codsubusu where inumexp=:inumexp and iyear=:iyear,
263,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
263,62,QryTipoAsun,select tipoasun.tipoasunto from tipoasun  left join expedien on tipoasun.codigo=expedien.itipoasunto where inumexp=:inumexp and iyear=:iyear,
264,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
264,4,qrycli,"select clientes.snombrecli,clientes.stelefonocli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from exclipro left join clientes on exclipro.icodcli=clientes.icodcli where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and clientes.tipobd=0",
264,24,qryexp,"select expedien.expediente,expedien.iyear,expedien.dfechaalta,expedien.descripcion,expedien.srefabogado,expedien.srefcliente,expedien.ftotalsuplidos,expedien.ftotalbaseimp,expedien.ftotaliva,expedien.ftotalirpf,expedien.ftotaleuro,expedien.ftotalprovisiones,expedien.ftotalcobro,expedien.fsaldofinal,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo, (isnull(fcuantia,0) + isnull(intereses,0) + isnull(costas,0)) as totalcuantia from expedien where inumexp=:inumexp and iyear=:iyear",
264,25,QryTipoProcedi,select procedi.procedimiento from procedi  left join expedien on procedi.codproce=expedien.codproce where inumexp=:inumexp and iyear=:iyear,
264,61,QryTipoExp,select tipoexp.tipoexp from tipoexp  left join expedien on tipoexp.codigo=expedien.itipoexp where inumexp=:inumexp and iyear=:iyear,
264,62,QryTipoAsun,select tipoasun.tipoasunto from tipoasun  left join expedien on tipoasun.codigo=expedien.itipoasunto where inumexp=:inumexp and iyear=:iyear,
264,64,qrycue,"select cuenexpe.dFecha,cuenexpe.sDescripcion,cuenexpe.fEntradasEuro,cuenexpe.fSalidasEuro from cuenexpe where inumexp=:inumexp and iyear=:iyear",
268,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
268,32,qryfact,"select ((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalbaseivairpf,((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro) as totalbaseiva,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0) + facturas.totalivaeuro) as totalhonodctoiva,
(isnull(facturas.totalderechoseuro,0) - isnull(facturas.totanticipos,0)) as totderechomenosanticipo,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) as totalbaseimp,
(facturas.totalsuplidoseuro + (facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalminuta, facturas.nombrecli,facturas.nifcli,facturas.domiciliocli,facturas.poblacioncli,facturas.codpostalcli,facturas.provinciacli,facturas.inumfactura,facturas.serie,facturas.fecha,facturas.totaleuro,(substring(facturas.cuentabanco,1,4) + '************' + substring(facturas.cuentabanco,17,4)) as cuentabancocifr,
(substring(facturas.iban,1,8) + replicate('*',LEN(facturas.iban)-8)) as ibancifr,(datename(day,facturas.fecha) + ' de ' + datename(month, facturas.fecha) + ' de ' + datename(year,facturas.fecha)) as fechafacturalarga,
(f2.totalderechoseuro - isnull(f2.totaldctoeuro,0)) as totalbaseimpAbo,f2.TotalIvaEuro as totalivaAbo,f2.TotalEuro as totaleuroabo,
(((isnull(facturas.honocondctolin,0) - isnull(facturas.totsolodctofact,0)) + isnull(facturas.totportes,0))) as baseConPortes,pl.descripcion as descplazo,
(select sum(isnull(salidaeuro,0)) - sum(isnull(totaldctoeuro,0)) FROM linefact
	left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea
	where (tipo = 'HONORARIO') AND (ISNULL(honogasto,0) = 0) and (ISNULL(bhonoarticulo,0) = 0) and (ISNULL(bhonodcto,0) = 0)
	and facturas.inumfactura = linefact.inumfactura and facturas.yearfact=linefact.yearfact and facturas.codsubusu=linefact.codsubusu and facturas.serie=linefact.serie) as totbaseimpsolohono,
(isnull(facturas.TotalEuro,0)) as totalletra, totalivaanticipos,totalivahonorarios,totalivaarticulos
 ,totalivagastos, totaldctoanticipos, totaldctohonorarios, totaldctoarticulos, totaldctogastos, 
totalsalidaanticipos, totalsalidahonorarios, totalsalidaarticulos, totalsalidagastos, 
(totalsalidaanticipos - totaldctoanticipos + totalivaanticipos) as totmenosdctomasivaanticipos, 
(totalsalidahonorarios - totaldctohonorarios + totalivahonorarios) as totmenosdctomasivahonorarios, 
(totalsalidaarticulos - totaldctoarticulos + totalivaarticulos) as totmenosdctomasivaarticulos, 
(totalsalidagastos - totaldctogastos + totalivagastos) as totmenosdctomasivagastos, identificadorTBAI
from facturas
left join facturas f2 on facturas.yearfactabonada=f2.yearfact and facturas.inumfactabonada=f2.inumfactura and facturas.serieabonada=f2.serie
left join facturasTicketBai ft on facturas.yearfact = ft.yearfact and facturas.inumfactura = ft.inumfactura and facturas.codsubusu = ft.codsubusu and facturas.serie = ft.serie
left join plazosc pl on pl.id = facturas.idplazos
left join
(select
	sum
	(
	case linefact.tipo
	when 'ANTICIPO' then
	isnull(totalivaeuro,0)
	else 0
	end) as totalivaanticipos,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.honogasto,0)
		when 0 then
			case ISNULL(c.bhonoarticulo,0)
			when 0 then
			isnull(totalivaeuro,0)
			else 0
			end
		else 0
		end
	else 0
	end) as totalivahonorarios,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.bhonoarticulo,0)
		when 1 then
		isnull(totalivaeuro,0)
		else 0
		end
	else 0
	end) as totalivaarticulos,
    sum  
    (   
     case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totalivaeuro,0) 
     else 0  
      end  
     else 0  
     end )as totalivagastos, 
     sum  
     (  
     case linefact.tipo 
     when 'ANTICIPO' then 
     isnull(totaldctoeuro,0) 
     else 0  
     end  )as totaldctoanticipos, 
     sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
     case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0) 
        when 0 then  
        isnull(totaldctoeuro,0) 
      else 0 
       end 
     else 0  
      end  
     else 0 
     end )as totaldctohonorarios, 
     sum 
     (case linefact.tipo 
     when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(totaldctoeuro,0) 
      else 0 
      end  
     else 0 
    end )as totaldctoarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totaldctoeuro,0) 
     else 0  
      end  
     else 0  
     end )as totaldctogastos, 
    sum  
        (case linefact.tipo  
        when 'ANTICIPO' then  
        isnull(salidaeuro,0) 
        else 0 
        end  )as totalsalidaanticipos, 
       sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
    case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0)  
        when 0 then 
        isnull(salidaeuro,0) 
      else 0  
        end 
     else 0 
      end  
     else 0  
     end )as totalsalidahonorarios, 
     sum 
     (case linefact.tipo 
    when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(salidaeuro,0) 
      else 0  
      end 
     else 0  
    end )as totalsalidaarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0)  
     when 1 then 
      isnull(salidaeuro,0)  
     else 0 
      end 
     else 0  
     end )as totalsalidagastos,                                                 
linefact.inumfactura as linefactinumfactura, linefact.yearfact as linefactyearfact, linefact.serie as linefactserie, linefact.codsubusu as linefactcodsubusu from linefact
left join cuencli c on c.icodcli=linefact.inumexpexho and c.dfecha =linefact.fechaconcep and c.linea  = linefact.lineacuentas
where (linefact.tipo = 'HONORARIO' or linefact.tipo = 'ANTICIPO')
group by linefact.inumfactura, linefact.yearfact,  linefact.serie, linefact.codsubusu)
as tbliva on tbliva.linefactinumfactura=facturas.inumfactura and tbliva.linefactyearfact=facturas.yearfact and tbliva.linefactcodsubusu=facturas.codsubusu and tbliva.linefactserie=facturas.serie
where facturas.inumfactura = @inumfactura and facturas.yearfact = @yearfact and facturas.codsubusu = @codsubusu and facturas.serie like @serie ",sourcedatosfact
268,45,qrylinefact,"select (linefact.descripcion + ' ' + isnull(cast(linefact.notas as varchar(MAX)),' ')) as descripnotas, (isnull(entradaeuro,0)+isnull(salidaeuro,0)) as importe,(isnull(salidaeuro,0)-isnull(totaldctoeuro,0)) as salidamenosdcto, linefact.descripcion,linefact.salidaeuro, s.nombre as usuario,
(round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0)) -
round((round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0))*(isnull(linefact.dctolinea2,0)/100),2) as honocondcto1dcto2,
art.referencia as referenciaart,linefact.origen,c.idartstock,c.honogasto,
(case linefact.tipoproformarel
 when 0 then 'Oficial'
 when 1 then 'Pro forma'
 when 2 then 'Presupuesto'
 when 3 then 'Albarán'
 when 4 then 'Pedido'
 When 5 then 'Orden'
 else ''
 end) as TipoDoc
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.porrecargo)/100) as cuotarec
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.poriva)/100) as cuotaivasinrec
,art.campo1,art.campo2,art.campo3,art.campo4,art.campo5,art.campo6,art.campo7,art.campo8
,art.campofecha1,art.campofecha2,art.campofecha3,art.campofecha4,art.notas as notasArt,
case when linefact.unidades=0 then linefact.fpreciounitario
else cast(round(isnull(linefact.fpreciounitario,0)-(isnull(linefact.totaldctoeuro,0)/isnull(linefact.unidades,1)),2) as money) end as preciounimenosdcto,
c.numexpediente  , case (isnull(cm.snombrecli, ''))
when '' then
	case (isnull(cliseg.snombrecli, ''))
	when '' then clisegclider.snombrecli
	else cliseg.snombrecli
	end
else cm.snombrecli
end
as pacientenombre from linefact
left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea 
left join subusu s on c.subusu=s.icodsubusu 
left join articulos art on c.idartstock=art.id left join controlmutua cm on linefact.linea = cm.linefact and linefact.inumfactura = cm.inumfactura and linefact.yearfact = cm.yearfact and linefact.codsubusu=cm.codsubusu and linefact.serie=cm.serie 
and linefact.fechaconcep=cm.dfechaconceptofact
left join segcli_cuencli segcuen on linefact.Origen = 'cli' and segcuen.icodcli_cuencli=linefact.inumexpexho and segcuen.linea_cuencli=linefact.lineacuentas and segcuen.dfecha_cuencli=linefact.fechaconcep
left join clientes cliseg on cliseg.icodcli=segcuen.icodcli_segcli
left join cuenclisegclider on linefact.origen = 'cli' and cuenclisegclider.icodclicuencli=linefact.inumexpexho and cuenclisegclider.dfechacuencli=linefact.fechaconcep and cuenclisegclider.lineacuencli=linefact.lineacuentas
left join segclider on segclider.id=cuenclisegclider.idsegclider and segclider.icodcli<>linefact.inumexpexho
left join clientes clisegclider on clisegclider.icodcli=segclider.icodcli  where linefact.inumfactura = @inumfactura and linefact.yearfact = @yearfact and linefact.codsubusu = @codsubusu and linefact.serie = @serie order by linefact.numero",sourcedatosfact
270,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
270,32,qryfact,"select ((totalderechoseuro - isnull(totaldctoeuro,0)) + totalivaeuro - totalirpfeuro) as totalbaseivairpf,(totalderechoseuro - isnull(totaldctoeuro,0) + totalivaeuro) as totalhonodctoiva,(totalderechoseuro - isnull(totaldctoeuro,0)) as totalbaseimp,((totalderechoseuro - isnull(totaldctoeuro,0)) + totalivaeuro) as totalbaseiva,(totalsuplidoseuro + (totalderechoseuro - isnull(totaldctoeuro,0)) + totalivaeuro - totalirpfeuro) as totalminuta,facturas.nombrecli,facturas.domiciliocli,facturas.poblacioncli,facturas.codpostalcli,facturas.provinciacli,facturas.inumfactura,facturas.serie,facturas.fecha,facturas.nifcli,facturas.TotalIvaEuro,facturas.TotalEuro,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr from facturas where inumfactura=:inumfactura and yearfact=:yearfact and codsubusu=:codsubusu and serie=:serie ",sourcedatosfact
270,34,qrylinefacthono,"select (descripcion  + ' ' + isnull(cast(linefacthono.notas as varchar(MAX)),' ')) as descripnotas,(isnull(entradaeuro,0)+isnull(salidaeuro,0)) as importe,linefacthono.descripcion,linefacthono.unidades,linefacthono.fpreciounitario,linefacthono.salidaeuro,linefacthono.totalivaeuro,linefacthono.TotalEuro from linefact as linefacthono left join cuenexpe c on linefacthono.inumexpexho=c.inumexp and linefacthono.iyear=c.iyear and linefacthono.fechaconcep=c.dfecha and linefacthono.lineacuentas=c.linea where linefacthono.inumfactura=:inumfactura and linefacthono.yearfact=:yearfact and linefacthono.codsubusu=:codsubusu and linefacthono.serie=:serie  and lower(tipo)='honorario' and (bhonodcto=0 or bhonodcto is null)",sourcedatosfact
271,4,qryclientes,"SELECT clientes.snombrecli,clientes.snifcli FROM clientes WHERE icodcli = @icodcli",
271,37,qrysubusu,SELECT subusu.nombre FROM subusu WHERE icodsubusu = @icodsubusu,
271,70,qryrecetasmedicas,"SELECT recetasMedicas.id, recetasmedicas.duracion,recetasmedicas.unidades,recetasmedicas.denominacion,recetasmedicas.dosificacion,recetasmedicas.formato,recetasmedicas.via,recetasmedicas.fechaprescripcion,recetasmedicas.diagnostico,recetasmedicas.instrucciones FROM recetasMedicas where id = @id",
271,71,qryc2,"SELECT snombrecli as snombretra, snifcli as sniftra, sdomiciliocli as sdomiciliotra, spoblacioncli as spoblaciontra, numcolegiado, especialidad FROM clientes c2 WHERE c2.codsubusu = @icodsubusu and tipobd=1",
271,72,qryrecetasxml,"SELECT numerolote, numero as numreceta, cve from recetasXML where id = @id_xml",
273,4,qryclientes,"select clientes.snombrecli,clientes.snifcli from clientes where icodcli=:icodcli",
273,37,qrysubusu,select subusu.nombre from subusu where icodsubusu=:icodsubusu,
273,70,qryrecetasMedicas,"select recetasMedicas.id, recetasMedicas.duracion,recetasMedicas.unidades,recetasMedicas.denominacion,recetasMedicas.dosificacion,recetasMedicas.formato,recetasMedicas.via,recetasMedicas.fechaprescripcion,recetasMedicas.diagnostico,recetasMedicas.instrucciones from recetasMedicas where id=:id",
273,71,qryc2,"select c2.especialidad,c2.numcolegiado from clientes c2 where c2.codsubusu=:icodsubusu and tipobd=1",
273,72,qryrecetasXML,"select numerolote, numero as numreceta, cve from recetasXML where id=:id_xml",
274,4,qryclientes,"select clientes.snombrecli,clientes.snifcli from clientes where icodcli=:icodcli",
274,37,qrysubusu,select subusu.nombre from subusu where icodsubusu=:icodsubusu,
274,70,qryrecetasMedicas,"select recetasMedicas.id, recetasMedicas.duracion,recetasMedicas.unidades,recetasMedicas.denominacion,recetasMedicas.dosificacion,recetasMedicas.formato,recetasMedicas.via,recetasMedicas.fechaprescripcion,recetasMedicas.diagnostico,recetasMedicas.instrucciones from recetasMedicas where id=:id",
274,71,qryc2,"select c2.especialidad,c2.numcolegiado from clientes c2 where c2.codsubusu=:icodsubusu and tipobd=1",
274,72,qryrecetasXML,"select numerolote, numero as numreceta, cve from recetasXML where id=:id_xml",
275,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
275,4,qrycli,"select clientes.snombrecli,clientes.sdomiciliocli,clientes.scodpostalcli,clientes.spoblacioncli,clientes.sprovinciacli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr from clientes where icodcli=:icodcli",
276,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion from director where icodprocu=:icodprocu",
276,4,qrycli,"select clientes.snombrecli,clientes.sdomiciliocli,clientes.scodpostalcli,clientes.spoblacioncli,clientes.sprovinciacli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr from clientes where icodcli=:icodcli",
278,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
278,4,qrycli,"select clientes.codigo,clientes.snombrecli,clientes.stelefonocli,clientes.fechaalta,clientes.snifcli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr from clientes where icodcli=:icodcli",
278,21,qrycontact,"select contacto.nombre,contacto.telefono1 from clientes inner join contactlin on clientes.icodcli = contactlin.icodcli inner join contacto on contactlin.icodcontacto = contacto.codcontacto where clientes.icodcli=:icodcli",
278,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
279,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
279,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,clientes.codigo,clientes.fechaalta,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr from clientes where icodcli=:icodcli",
279,21,qrycontact,"select contacto.nombre,contacto.telefono1,contacto.email1 from clientes inner join contactlin on clientes.icodcli = contactlin.icodcli inner join contacto on contactlin.icodcontacto = contacto.codcontacto where clientes.icodcli=:icodcli",
279,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
280,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
280,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,clientes.codigo,clientes.fechaalta,clientes.notas,clientes.notas2,clientes.notas3,clientes.notas4,clientes.notas5,clientes.notas6,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr from clientes where icodcli=:icodcli",
280,21,qrycontact,"select contacto.nombre,contacto.telefono1,contacto.email1 from clientes inner join contactlin on clientes.icodcli = contactlin.icodcli inner join contacto on contactlin.icodcontacto = contacto.codcontacto where clientes.icodcli=:icodcli",
280,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
281,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
281,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr from clientes where icodcli=:icodcli",
281,36,qrycliadjun,"select cliadjun.fecha,cliadjun.imagen,cliadjun.descripcion from cliadjun where cliadjun.icodcli=:icodcli",
282,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
282,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr from clientes where icodcli=:icodcli",
282,35,qryseg,"select segcli.dfechaact,segcli.sactuacion,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' +DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' +DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segcli left join subusu on segcli.subusu=subusu.icodsubusu where icodcli=:icodcli",
283,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
283,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr from clientes where icodcli=:icodcli",
283,35,qryseg,"select segcli.dfechaact,segcli.sactuacion,segcli.notas,subusu.nombre as usuario,DATENAME(hh, horainiact) + ':' +DATENAME(mi, horainiact) + ':' + DATENAME(ss, horainiact) as horainiact,DATENAME(hh, horafinact) + ':' +DATENAME(mi, horafinact) + ':' + DATENAME(ss, horafinact) as horafinact,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo from segcli left join subusu on segcli.subusu=subusu.icodsubusu where icodcli=:icodcli",
283,37,qrysubusu,select subusu.nombre from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu where clientes.icodcli=:icodcli,
284,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
284,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,clientes.ftotalbaseimp,clientes.ftotaliva,clientes.ftotalirpf,clientes.ftotaleuro,clientes.ftotalcobro,clientes.fsaldofinal,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr from clientes where icodcli=:icodcli",
284,57,qrycue,"select (sdescripcion  + ' ' + isnull(cast(notas as varchar(MAX)),' ')) as descripnotas,cuencli.dfecha,cuencli.sDescripcion,cuencli.fentradaseuro,cuencli.fsalidaseuro from cuencli where icodcli=:icodcli",
285,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
285,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,clientes.totaloportunidades,clientes.totalprevisionoportunidades,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr from clientes where icodcli=:icodcli",
285,73,qryoporcli,"select oporcli.*,subusu.nombre as subusuario from oporcli left join subusu on oporcli.icodusu=subusu.icodsubusu where oporcli.icodcli=:icodcli",
288,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar)as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
288,4,qrycli,"select clientes.snombrecli,clientes.snifcli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes where icodcli=:icodcli",
289,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
289,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes where icodcli=:icodcli",
290,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
290,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.sfaxcli,clientes.email,clientes.pagweb,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes where icodcli=:icodcli",
290,35,qryseg,"select null,segcli.sactuacion,segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero, CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo  from segcli left join subusu on segcli.subusu=subusu.icodsubusu left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1 left join clientes on st.icodtercero=clientes.icodcli where segcli.icodcli=:icodcli order by segcli.dfechaact,segcli.horainiact",
291,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+datename(month, getdate())+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
291,4,qrycli,"select clientes.codigo,clientes.snombrecli,clientes.sdomiciliocli,clientes.scodpostalcli,clientes.spoblacioncli,clientes.stelefonocli,clientes.smovilcli,clientes.email,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes where icodcli=:icodcli",
291,35,qryseg,"select segcli.notas,segcli.notas2,segcli.notas3,segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero, CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo  from segcli left join subusu on segcli.subusu=subusu.icodsubusu left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1 left join clientes on st.icodtercero=clientes.icodcli where segcli.icodcli=:icodcli order by segcli.dfechaact,segcli.horainiact",
291,37,qrysubusu,"select subusu.nombre ,tra.especialidad as especialidadtra  ,tra.numcolegiado as numcolegiadotra  from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu   left join clientes tra on subusu.icodsubusu=tra.CodSubUSu and tra.tipobd=1  where clientes.icodcli=:icodcli",
291,76,qryclivaloresperfil,"select [1] as Campo0101,[2] as Campo0102,[3] as Campo0103,[4] as Campo0104,[5] as Campo0105,[6] as Campo0106,[7] as Campo0107,[8] as Campo0108,[9] as Campo0109,[10]  as Campo0110,[11] as Campo0201,[12] as Campo0202,[13] as Campo0203,[14] as Campo0204,[15] as Campo0205,[16] as Campo0206,[17] as Campo0207,[18] as Campo0208,[19] as Campo0209,[20] as Campo0210,[21] as Campo0301, [22] as Campo0302,[23] as Campo0303,[24] as Campo0304,[25] as Campo0305,[26] as Campo0306,[27] as Campo0307,[28] as Campo0308,[29] as Campo0309,[30] as Campo0310, [31] as Campo0111, [32] as Campo0112,[33] as Campo0113,[34] as Campo0114,[35] as Campo0115,[36] as Campo0211,[37] as Campo0212,[38] as Campo0213,[39] as Campo0214,[40] as Campo0215, [41] as Campo0311, [42] as Campo0312,[43] as Campo0313,[44] as Campo0314,[45] as Campo0315 from cliValoresPerfil PIVOT( min(valor) FOR idcampo IN ([1],[2],[3],[4],[5],[6],[7],[8],[9],[10],[11],[12],[13],[14],[15],[16],[17],[18],[19],[20],[21],[22],[23],[24],[25],[26],[27],[28],[29],[30],[31],[32],[33],[34],[35],[36],[37],[38],[39],[40],[41],[42],[43],[44],[45])) AS pt where icodcli=:icodcli",
292,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
292,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
293,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
293,4,qrycli,"select clientes.snombrecli,clientes.snifcli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
294,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
294,4,qrycli,"select clientes.snombrecli,clientes.snifcli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
294,35,qryseg,"select null,segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero, CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo, isnull(coleg.numcolegiado,'') as numcolegusuact  from segcli left join subusu on segcli.subusu=subusu.icodsubusu  left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1  left join clientes on st.icodtercero=clientes.icodcli  left join vlistadobonos on vlistadobonos.id = segcli.idbono  left join clientes coleg on segcli.subusu =coleg.codsubusu and coleg.tipobd=1 where segcli.icodcli=:icodcli and tipoactu <> 'Aviso' order by segcli.dfechaact,segcli.horainiact",
295,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
295,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
296,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
296,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.scodpostalcli,clientes.spoblacioncli,clientes.sprovinciacli,clientes.stelefonocli,clientes.smovilcli,clientes.telefono2,clientes.sfaxcli,clientes.telefono3,clientes.email,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
296,35,qryseg,"select null,segcli.sactuacion,segcli.notas,segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero, CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo, isnull(coleg.numcolegiado,'') as numcolegusuact  from segcli left join subusu on segcli.subusu=subusu.icodsubusu  left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1  left join clientes on st.icodtercero=clientes.icodcli  left join vlistadobonos on vlistadobonos.id = segcli.idbono  left join clientes coleg on segcli.subusu =coleg.codsubusu and coleg.tipobd=1 where segcli.icodcli=:icodcli and tipoactu <> 'Aviso' order by segcli.dfechaact,segcli.horainiact",
296,37,qrysubusu,"select subusu.nombre ,tra.especialidad as especialidadtra  ,tra.numcolegiado as numcolegiadotra  from subusu left join clientes on subusu.icodsubusu=clientes.codsubusu   left join clientes tra on subusu.icodsubusu=tra.CodSubUSu and tra.tipobd=1  where clientes.icodcli=:icodcli",
297,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
297,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
297,35,qryseg,"select segcli.sactuacion,segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero, CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo, isnull(coleg.numcolegiado,'') as numcolegusuact  from segcli left join subusu on segcli.subusu=subusu.icodsubusu  left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1  left join clientes on st.icodtercero=clientes.icodcli  left join vlistadobonos on vlistadobonos.id = segcli.idbono  left join clientes coleg on segcli.subusu =coleg.codsubusu and coleg.tipobd=1 where segcli.icodcli=:icodcli and tipoactu <> 'Aviso' order by segcli.dfechaact,segcli.horainiact",
299,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
299,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
299,73,qryoporcli,"select oporcli.*,subusu.nombre as subusuario from oporcli left join subusu on oporcli.icodusu=subusu.icodsubusu where oporcli.icodopor=:icodopor",
299,77,qryoporcuentas," select oporcuentas.*,subusu.nombre as subusuario  ,(oporcuentas.oportunidad+ ' ' + isnull(cast(oporcuentas.notas as varchar(MAX)),' ')) as conceptonotas  from oporcuentas  left join subusu on oporcuentas.icodusu=subusu.icodsubusu  where oporcuentas.icodopor=:icodopor order by oporcuentas.orden ",
300,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
300,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
300,78,qryprevcobros,"SELECT prevcobros.fechaingreso as fechagasing,prevcobros.nombrecli as cliente, prevcobros.cobrado as realizada,prevcobros.fechacobro as fecharealizada,prevcobros.inumfactura as inumfact,prevcobros.ctacliente as ctaacrcli,prevcobros.ctaingreso as ctagasing,1 as tipo,(case prevcobros.factura when 1 then 'Factura Oficial' when 2 then (case prevcobros.tipoprof when 2 then 'Presupuesto' when 3 then 'Albarán' else 'Factura Proforma' end) else '' end) as tipofactura, l.fecha as fecharemesa, (case isnull(l.fecha,'') when '' then 0 else 1 end) as estaremesado,r.banco as banco,(case prevcobros.factura when 1 then f.fecha when 2 then prof.fecha end) as fechafact,f.tipologia1 as tip1,f.tipologia2 as tip2,f.tipologia3 as tip3,cli.fechaalta as fechaaltacliente, null,prevcobros.concepto,prevcobros.total,centrospredef.sdescripcion,prevcobros.total as totalletra ,s.nombre as usuario ,vistapac.pacientenombre  FROM prevcobros  left join linereme l on l.idprevcobros=prevcobros.id left join remesas r on l.idremesa=r.idremesa left join facturas f on f.yearfact=prevcobros.yearfact and f.inumfactura=prevcobros.inumfactura and f.codsubusu=prevcobros.subusufact and f.serie=prevcobros.serie left join proforma prof on prof.yearfact=prevcobros.yearfact and prof.inumfactura=prevcobros.inumfactura and prof.codsubusu=prevcobros.subusufact and prof.tipoprof=prevcobros.tipoprof left join clientes cli on prevcobros.inumexp=cli.icodcli and prevcobros.origen='cli'left join centrospredef on centrospredef.id=cli.idcentros left join subusu s on prevcobros.codsubusu=s.icodsubusu  left join vListadoCobrosPacientes vistapac on vistapac.id=prevcobros.id where prevcobros.id=:id ",sourcedatosfact
301,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
301,32,qryfact,"select ((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalbaseivairpf,((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro) as totalbaseiva,(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0) + facturas.totalivaeuro) as totalhonodctoiva,(isnull(facturas.totalderechoseuro,0) - isnull(facturas.totanticipos,0)) as totderechomenosanticipo, (facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) as totalbaseimp,(facturas.totalsuplidoseuro + (facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalminuta,facturas.nombrecli,facturas.nifcli,facturas.domiciliocli,facturas.poblacioncli,facturas.codpostalcli,facturas.provinciacli,facturas.inumfactura,facturas.serie,facturas.fecha,facturas.totaldctoeuro,facturas.totaleuro,(substring(facturas.cuentabanco,1,4)+'************'+substring(facturas.cuentabanco,17,4)) as cuentabancocifr,(substring(facturas.iban,1,8)+replicate('*',LEN(facturas.iban)-8)) as ibancifr,(datename(day,facturas.fecha)+' de '+datename(month, facturas.fecha)+' de '+datename(year,facturas.fecha)) as fechafacturalarga ,(f2.totalderechoseuro - isnull(f2.totaldctoeuro,0)) as totalbaseimpAbo,f2.TotalIvaEuro as totalivaAbo,f2.TotalEuro as totaleuroabo ,(((isnull(facturas.honocondctolin,0) - isnull(facturas.totsolodctofact,0)) + isnull(facturas.totportes,0))) as baseConPortes,pl.descripcion as descplazo ,(select sum(isnull(salidaeuro,0)) - sum(isnull(totaldctoeuro,0)) FROM linefact    left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea   where (tipo = 'HONORARIO') AND (ISNULL(honogasto,0) = 0) and (ISNULL(bhonoarticulo,0) = 0) and (ISNULL(bhonodcto,0) = 0)  and facturas.inumfactura = linefact.inumfactura and facturas.yearfact=linefact.yearfact and facturas.codsubusu=linefact.codsubusu and facturas.serie=linefact.serie) as totbaseimpsolohono ,(isnull(facturas.TotalEuro,0)) as totalletra, totalivaanticipos,totalivahonorarios,totalivaarticulos  from facturas   left join facturas f2 on facturas.yearfactabonada=f2.yearfact and facturas.inumfactabonada=f2.inumfactura and facturas.serieabonada=f2.serie  left join plazosc pl on pl.id = facturas.idplazos  left join  (select  sum  (  case linefact.tipo  when 'ANTICIPO' then  isnull(totalivaeuro,0)  else 0  end  )as totalivaanticipos,  sum (  case linefact.tipo  when 'HONORARIO' then  case ISNULL(c.honogasto,0)  when 0 then     case ISNULL(c.bhonoarticulo,0)     when 0 then     isnull(totalivaeuro,0)     else 0     end    else 0   end    else 0   end )as totalivahonorarios,  sum  (  case linefact.tipo  when 'HONORARIO' then   case ISNULL(c.bhonoarticulo,0)   when 1 then   isnull(totalivaeuro,0)   else 0   end   else 0  end )as totalivaarticulos,   linefact.inumfactura as linefactinumfactura, linefact.yearfact as linefactyearfact, linefact.serie as linefactserie, linefact.codsubusu as linefactcodsubusu from linefact  left join cuencli c on c.icodcli=linefact.inumexpexho and c.dfecha =linefact.fechaconcep and c.linea  = linefact.lineacuentas  where (linefact.tipo='HONORARIO'  or linefact.tipo='ANTICIPO')  group by linefact.inumfactura, linefact.yearfact,  linefact.serie, linefact.codsubusu)  as tbliva on tbliva.linefactinumfactura=facturas.inumfactura and tbliva.linefactyearfact=facturas.yearfact and tbliva.linefactcodsubusu=facturas.codsubusu and tbliva.linefactserie=facturas.serie  where facturas.inumfactura=:inumfactura and facturas.yearfact=:yearfact and facturas.codsubusu=:codsubusu and facturas.serie like :serie ",sourcedatosfact
301,45,qrylinefact,"select (linefact.descripcion  + ' ' + isnull(cast(linefact.notas as varchar(MAX)),' ')) as descripnotas,(isnull(entradaeuro,0)+isnull(salidaeuro,0)) as importe,(isnull(salidaeuro,0)-isnull(totaldctoeuro,0)) as salidamenosdcto,linefact.descripcion,linefact.salidaeuro,s.nombre as usuario ,(round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0)) - round((round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0))*(isnull(linefact.dctolinea2,0)/100),2) as honocondcto1dcto2 ,art.referencia as referenciaart,linefact.origen,c.idartstock  ,(case linefact.tipoproformarel  when 0 then 'Oficial' when 1 then 'Pro forma' when 2 then 'Presupuesto' when 3 then 'Albarán' when 4 then 'Pedido' When 5 then 'Orden' else '' end) as TipoDoc ,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.porrecargo)/100) as cuotarec ,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.poriva)/100) as cuotaivasinrec ,art.campo1,art.campo2,art.campo3,art.campo4,art.campo5,art.campo6,art.campo7,art.campo8 ,art.campofecha1,art.campofecha2,art.campofecha3,art.campofecha4,art.notas as notasArt, case when linefact.unidades=0 then linefact.fpreciounitario  else cast(round(isnull(linefact.fpreciounitario,0)-(isnull(linefact.totaldctoeuro,0)/isnull(linefact.unidades,1)),2) as money) end as preciounimenosdcto,  c.numexpediente  ,case (isnull(cliseg.snombrecli,''))  when '' then clisegclider.snombrecli  else cliseg.snombrecli  end  as pacientenombre  from linefact  left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea  left join subusu s on c.subusu=s.icodsubusu  left join articulos art on c.idartstock=art.id  left join segcli_cuencli segcuen on linefact.Origen='cli' and segcuen.icodcli_cuencli=linefact.inumexpexho and segcuen.linea_cuencli=linefact.lineacuentas and segcuen.dfecha_cuencli=linefact.fechaconcep  left join clientes cliseg on cliseg.icodcli=segcuen.icodcli_segcli  left join cuenclisegclider on linefact.origen='cli' and  cuenclisegclider.icodclicuencli=linefact.inumexpexho and cuenclisegclider.dfechacuencli=linefact.fechaconcep and cuenclisegclider.lineacuencli=linefact.lineacuentas  left join segclider on segclider.id=cuenclisegclider.idsegclider and segclider.icodcli<>linefact.inumexpexho   left join clientes clisegclider on clisegclider.icodcli=segclider.icodcli  where linefact.inumfactura=:inumfactura and linefact.yearfact=:yearfact and linefact.codsubusu=:codsubusu and linefact.serie=:serie  order by linefact.numero",sourcedatosfact
302,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
302,32,qryfact,"select ((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalbaseivairpf,((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro) as totalbaseiva,(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0) + facturas.totalivaeuro) as totalhonodctoiva,(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) as totalbaseimp,(isnull(facturas.totalderechoseuro,0) - isnull(facturas.totanticipos,0)) as totderechomenosanticipo, (facturas.totalsuplidoseuro + (facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalminuta,facturas.nombrecli,facturas.nifcli,facturas.domiciliocli,facturas.poblacioncli,facturas.codpostalcli,facturas.provinciacli,facturas.inumfactura,facturas.serie,facturas.fecha,facturas.totaldctoeuro,facturas.totaleuro,(substring(facturas.cuentabanco,1,4)+'************'+substring(facturas.cuentabanco,17,4)) as cuentabancocifr,(substring(facturas.iban,1,8)+replicate('*',LEN(facturas.iban)-8)) as ibancifr,(datename(day,facturas.fecha)+' de '+datename(month, facturas.fecha)+' de '+datename(year,facturas.fecha)) as fechafacturalarga ,(f2.totalderechoseuro - isnull(f2.totaldctoeuro,0)) as totalbaseimpAbo,f2.TotalIvaEuro as totalivaAbo,f2.TotalEuro as totaleuroabo ,(((isnull(facturas.honocondctolin,0) - isnull(facturas.totsolodctofact,0)) + isnull(facturas.totportes,0))) as baseConPortes,pl.descripcion as descplazo ,(select sum(isnull(salidaeuro,0)) - sum(isnull(totaldctoeuro,0)) FROM linefact    left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea   where (tipo = 'HONORARIO') AND (ISNULL(honogasto,0) = 0) and (ISNULL(bhonoarticulo,0) = 0) and (ISNULL(bhonodcto,0) = 0)  and facturas.inumfactura = linefact.inumfactura and facturas.yearfact=linefact.yearfact and facturas.codsubusu=linefact.codsubusu and facturas.serie=linefact.serie) as totbaseimpsolohono ,(isnull(facturas.TotalEuro,0)) as totalletra, totalivaanticipos,totalivahonorarios,totalivaarticulos  from facturas   left join facturas f2 on facturas.yearfactabonada=f2.yearfact and facturas.inumfactabonada=f2.inumfactura and facturas.serieabonada=f2.serie  left join plazosc pl on pl.id = facturas.idplazos  left join  (select  sum  (  case linefact.tipo  when 'ANTICIPO' then  isnull(totalivaeuro,0)  else 0  end  )as totalivaanticipos,  sum (  case linefact.tipo  when 'HONORARIO' then  case ISNULL(c.honogasto,0)  when 0 then     case ISNULL(c.bhonoarticulo,0)     when 0 then     isnull(totalivaeuro,0)     else 0     end    else 0   end    else 0   end )as totalivahonorarios,  sum  (  case linefact.tipo  when 'HONORARIO' then   case ISNULL(c.bhonoarticulo,0)   when 1 then   isnull(totalivaeuro,0)   else 0   end   else 0  end )as totalivaarticulos,   linefact.inumfactura as linefactinumfactura, linefact.yearfact as linefactyearfact, linefact.serie as linefactserie, linefact.codsubusu as linefactcodsubusu from linefact  left join cuencli c on c.icodcli=linefact.inumexpexho and c.dfecha =linefact.fechaconcep and c.linea  = linefact.lineacuentas  where (linefact.tipo='HONORARIO'  or linefact.tipo='ANTICIPO')  group by linefact.inumfactura, linefact.yearfact,  linefact.serie, linefact.codsubusu)  as tbliva on tbliva.linefactinumfactura=facturas.inumfactura and tbliva.linefactyearfact=facturas.yearfact and tbliva.linefactcodsubusu=facturas.codsubusu and tbliva.linefactserie=facturas.serie  where facturas.inumfactura=:inumfactura and facturas.yearfact=:yearfact and facturas.codsubusu=:codsubusu and facturas.serie like :serie ",sourcedatosfact
302,45,qrylinefact,"select (linefact.descripcion  + ' ' + isnull(cast(linefact.notas as varchar(MAX)),' ')) as descripnotas,(isnull(entradaeuro,0)+isnull(salidaeuro,0)) as importe,(isnull(salidaeuro,0)-isnull(totaldctoeuro,0)) as salidamenosdcto,linefact.descripcion,linefact.salidaeuro,s.nombre as usuario ,(round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0)) - round((round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0))*(isnull(linefact.dctolinea2,0)/100),2) as honocondcto1dcto2 ,art.referencia as referenciaart,linefact.origen,c.idartstock  ,(case linefact.tipoproformarel  when 0 then 'Oficial' when 1 then 'Pro forma' when 2 then 'Presupuesto' when 3 then 'Albarán' when 4 then 'Pedido' When 5 then 'Orden' else '' end) as TipoDoc ,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.porrecargo)/100) as cuotarec ,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.poriva)/100) as cuotaivasinrec ,art.campo1,art.campo2,art.campo3,art.campo4,art.campo5,art.campo6,art.campo7,art.campo8 ,art.campofecha1,art.campofecha2,art.campofecha3,art.campofecha4,art.notas as notasArt, case when linefact.unidades=0 then linefact.fpreciounitario  else cast(round(isnull(linefact.fpreciounitario,0)-(isnull(linefact.totaldctoeuro,0)/isnull(linefact.unidades,1)),2) as money) end as preciounimenosdcto  from linefact  left join cuencli c on linefact.inumexpexho=c.icodcli  and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea  left join subusu s on c.subusu=s.icodsubusu  left join articulos art on c.idartstock=art.id where linefact.inumfactura=:inumfactura and linefact.yearfact=:yearfact and linefact.codsubusu=:codsubusu and linefact.serie=:serie  order by linefact.numero",sourcedatosfact
303,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
303,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,clientes.icodcli,exclipro.numreferencia as numreferencia from exclipro left join clientes on exclipro.icodcli=clientes.icodcli  where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and (clientes.tipobd=0)",
303,73,,,
303,77,,,
304,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
304,4,qrycli,"select clientes.iban,clientes.bicswift,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,clientes.icodcli,exclipro.numreferencia as numreferencia from exclipro left join clientes on exclipro.icodcli=clientes.icodcli  where exclipro.inumexp=:inumexp and exclipro.iyear=:iyear and (clientes.tipobd=0)",
304,79,qrypacexp,"select pacexp.nmandato,pacexp.snombrecli,pacexp.snombrepais,pacexp.icodcli from exppacientes left join clientes as pacexp on exppacientes.icodcli=pacexp.icodcli where exppacientes.inumexp=:inumexp and exppacientes.iyear=:iyear ",
304,80,,,
305,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
305,4,qrycli,"select clientes.nmandato,clientes.snombrecli,clientes.sdomiciliocli,clientes.scodpostalcli,clientes.spoblacioncli,clientes.snombrepais,clientes.iban,clientes.bicswift,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
306,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
306,4,qrycli,"select clientes.snombrecli,clientes.snifcli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
308,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
308,4,qrycli,"select clientes.snombrecli,clientes.snifcli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
309,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
309,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
309,73,qryoporcli,"select oporcli.*,subusu.nombre as subusuario from oporcli left join subusu on oporcli.icodusu=subusu.icodsubusu where oporcli.icodopor=:icodopor",
309,77,qryoporcuentas," select oporcuentas.*,subusu.nombre as subusuario  ,(oporcuentas.oportunidad+ ' ' + isnull(cast(oporcuentas.notas as varchar(MAX)),' ')) as conceptonotas  from oporcuentas  left join subusu on oporcuentas.icodusu=subusu.icodsubusu  where oporcuentas.icodopor=:icodopor order by oporcuentas.orden ",
310,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
310,4,qrycli,"select clientes.nmandato,clientes.snombrecli,clientes.sdomiciliocli,clientes.scodpostalcli,clientes.spoblacioncli,clientes.snombrepais,clientes.iban,clientes.bicswift,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
312,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
312,4,qrycli,"select clientes.nmandato,clientes.snombrecli,clientes.sdomiciliocli,clientes.scodpostalcli,clientes.spoblacioncli,clientes.snombrepais,clientes.iban,clientes.bicswift, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
315,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
315,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
315,73,qryoporcli,"select oporcli.*,subusu.nombre as subusuario, ISNULL(C.snombrecli, E.descripcion) as asociadoa from oporcli
left join subusu on oporcli.icodusu=subusu.icodsubusu
left join clientes C on oporcli.icodcliRelacionado = C.icodcli
left join expedien E on oporcli.inumexp = E.inumexp AND oporcli.iyear = E.iyear where oporcli.icodopor = @icodopor",
315,77,qryoporcuentas,"select oporcuentas.*, subusu.nombre as subusuario,
(oporcuentas.oportunidad + ' ' + isnull(cast(oporcuentas.notas as varchar(MAX)),' ')) as conceptonotas
 ,round(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * (ISNULL(poriva, 0) + ISNULL(porrecargo, 0)))/100,2) as totaliva 
    ,round(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * isnull(irpf,0))/100,2) as totalirpf 
    ,round((isnull(importecierre,0) -(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * isnull(irpf,0))/100) + 
(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * (ISNULL(poriva, 0) + ISNULL(porrecargo, 0)))/100)),2) as total 
from oporcuentas
left join subusu on oporcuentas.icodusu=subusu.icodsubusu
where oporcuentas.icodopor = @icodopor order by oporcuentas.orden ",
316,37,qrysubusu,"SELECT subusu.nombre,subusu.numcolegiadotra ,tra.especialidad AS especialidadtra  ,tra.numcolegiado as numcolegiadotra  FROM subusu LEFT JOIN clientes ON subusu.icodsubusu=clientes.codsubusu   LEFT JOIN clientes tra ON subusu.icodsubusu=tra.CodSubUSu AND tra.tipobd=1  WHERE clientes.icodcli = @icodcli",
317,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.codigo,clientes.fechanacimiento,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
317,81,qryhistoriaclinica,select 'Historia Clínica',
319,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) +'/'+ cast(datepart(mm,getdate()) as varchar) +'/'+ cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,(datename(day,getdate())+' de '+lower(datename(month, getdate()))+' de '+datename(year,getdate())) as fechaimpresionlarga from director where icodprocu=:icodprocu",
319,4,qrycli,"select clientes.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4)+'************'+substring(cuentabanco,17,4)) as cuentabancocifr,(substring(iban,1,8)+replicate('*',LEN(iban)-8)) as ibancifr,clientes.icodcli  from clientes  where clientes.icodcli=:icodcli",
322,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
322,4,qrycli,"select clientes.codigo,clientes.snombrecli,clientes.edad,clientes.sdomiciliocli,clientes.spoblacioncli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
322,81,qryhistoriaclinica,select 'Historia Clínica',
323,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
323,4,qrycli,"select clientes.snombrecli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
323,78,qryprevcobros,"SELECT prevcobros.fechaingreso as fechagasing,prevcobros.nombrecli as cliente,
prevcobros.cobrado as realizada,prevcobros.fechacobro as fecharealizada,
prevcobros.inumfactura as inumfact,prevcobros.ctacliente as ctaacrcli,
prevcobros.ctaingreso as ctagasing, 1 as tipo,
(case prevcobros.factura when 1 then 'Factura Oficial' when 2 then
(case prevcobros.tipoprof when 2 then 'Presupuesto' when 3 then 'Albarán'
else 'Factura Proforma' end)
else '' end) as tipofactura,
l.fecha as fecharemesa,
(case isnull(l.fecha, '') when '' then 0 else 1 end) as estaremesado,
r.banco as banco,
(case prevcobros.factura when 1 then f.fecha when 2 then prof.fecha end) as fechafact,
f.tipologia1 as tip1,f.tipologia2 as tip2,f.tipologia3 as tip3,
cli.fechaalta as fechaaltacliente, null,prevcobros.concepto,prevcobros.total,centrospredef.sdescripcion,prevcobros.total as totalletra ,s.nombre as usuario, cp2.sdescripcion as sdescripcioncentrospredef ,vistapac.pacientenombre  FROM prevcobros
left join linereme l on l.idprevcobros=prevcobros.id
left join remesas r on l.idremesa=r.idremesa
left join facturas f on f.yearfact=prevcobros.yearfact and f.inumfactura=prevcobros.inumfactura and
f.codsubusu=prevcobros.subusufact and f.serie=prevcobros.serie
left join proforma prof on prof.yearfact=prevcobros.yearfact and prof.inumfactura=prevcobros.inumfactura and
prof.codsubusu=prevcobros.subusufact and prof.tipoprof=prevcobros.tipoprof
left join clientes cli on prevcobros.inumexp=cli.icodcli and prevcobros.origen = 'cli'
left join centrospredef on centrospredef.id=cli.idcentros
left join centrospredef cp2 on cp2.id=prevcobros.idcentros
left join subusu s on prevcobros.codsubusu=s.icodsubusu left join vListadoCobrosPacientes vistapac on vistapac.id=prevcobros.id  where prevcobros.id = @id ",sourcedatosfact
324,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
324,4,qrycli,"select clientes.snombrecli,clientes.snifcli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
325,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
325,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.smovilcli,clientes.telefono2,clientes.telefono3,clientes.email,clientes.pagweb,clientes.codigo,clientes.fechaalta, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
325,37,qrysubusu,"SELECT subusu.nombre ,tra.especialidad AS especialidadtra  ,tra.numcolegiado as numcolegiadotra  FROM subusu LEFT JOIN clientes ON subusu.icodsubusu=clientes.codsubusu   LEFT JOIN clientes tra ON subusu.icodsubusu=tra.CodSubUSu AND tra.tipobd=1  WHERE clientes.icodcli = @icodcli",
328,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
328,32,qryfact,"select ((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalbaseivairpf,((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro) as totalbaseiva,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0) + facturas.totalivaeuro) as totalhonodctoiva,
(isnull(facturas.totalderechoseuro,0) - isnull(facturas.totanticipos,0)) as totderechomenosanticipo,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) as totalbaseimp,
(facturas.totalsuplidoseuro + (facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalminuta, facturas.nombrecli,facturas.nifcli,facturas.domiciliocli,facturas.poblacioncli,facturas.codpostalcli,facturas.provinciacli,facturas.inumfactura,facturas.serie,facturas.fecha,facturas.totaleuro,(substring(facturas.cuentabanco,1,4) + '************' + substring(facturas.cuentabanco,17,4)) as cuentabancocifr,
(substring(facturas.iban,1,8) + replicate('*',LEN(facturas.iban)-8)) as ibancifr,(datename(day,facturas.fecha) + ' de ' + datename(month, facturas.fecha) + ' de ' + datename(year,facturas.fecha)) as fechafacturalarga,
(f2.totalderechoseuro - isnull(f2.totaldctoeuro,0)) as totalbaseimpAbo,f2.TotalIvaEuro as totalivaAbo,f2.TotalEuro as totaleuroabo,
(((isnull(facturas.honocondctolin,0) - isnull(facturas.totsolodctofact,0)) + isnull(facturas.totportes,0))) as baseConPortes,pl.descripcion as descplazo,
(select sum(isnull(salidaeuro,0)) - sum(isnull(totaldctoeuro,0)) FROM linefact
	left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea
	where (tipo = 'HONORARIO') AND (ISNULL(honogasto,0) = 0) and (ISNULL(bhonoarticulo,0) = 0) and (ISNULL(bhonodcto,0) = 0)
	and facturas.inumfactura = linefact.inumfactura and facturas.yearfact=linefact.yearfact and facturas.codsubusu=linefact.codsubusu and facturas.serie=linefact.serie) as totbaseimpsolohono,
(isnull(facturas.TotalEuro,0)) as totalletra, totalivaanticipos,totalivahonorarios,totalivaarticulos
 ,totalivagastos, totaldctoanticipos, totaldctohonorarios, totaldctoarticulos, totaldctogastos, 
totalsalidaanticipos, totalsalidahonorarios, totalsalidaarticulos, totalsalidagastos, 
(totalsalidaanticipos - totaldctoanticipos + totalivaanticipos) as totmenosdctomasivaanticipos, 
(totalsalidahonorarios - totaldctohonorarios + totalivahonorarios) as totmenosdctomasivahonorarios, 
(totalsalidaarticulos - totaldctoarticulos + totalivaarticulos) as totmenosdctomasivaarticulos, 
(totalsalidagastos - totaldctogastos + totalivagastos) as totmenosdctomasivagastos, identificadorTBAI
from facturas
left join facturas f2 on facturas.yearfactabonada=f2.yearfact and facturas.inumfactabonada=f2.inumfactura and facturas.serieabonada=f2.serie
left join facturasTicketBai ft on facturas.yearfact = ft.yearfact and facturas.inumfactura = ft.inumfactura and facturas.codsubusu = ft.codsubusu and facturas.serie = ft.serie
left join plazosc pl on pl.id = facturas.idplazos
left join
(select
	sum
	(
	case linefact.tipo
	when 'ANTICIPO' then
	isnull(totalivaeuro,0)
	else 0
	end) as totalivaanticipos,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.honogasto,0)
		when 0 then
			case ISNULL(c.bhonoarticulo,0)
			when 0 then
			isnull(totalivaeuro,0)
			else 0
			end
		else 0
		end
	else 0
	end) as totalivahonorarios,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.bhonoarticulo,0)
		when 1 then
		isnull(totalivaeuro,0)
		else 0
		end
	else 0
	end) as totalivaarticulos,
    sum  
    (   
     case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totalivaeuro,0) 
     else 0  
      end  
     else 0  
     end )as totalivagastos, 
     sum  
     (  
     case linefact.tipo 
     when 'ANTICIPO' then 
     isnull(totaldctoeuro,0) 
     else 0  
     end  )as totaldctoanticipos, 
     sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
     case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0) 
        when 0 then  
        isnull(totaldctoeuro,0) 
      else 0 
       end 
     else 0  
      end  
     else 0 
     end )as totaldctohonorarios, 
     sum 
     (case linefact.tipo 
     when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(totaldctoeuro,0) 
      else 0 
      end  
     else 0 
    end )as totaldctoarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totaldctoeuro,0) 
     else 0  
      end  
     else 0  
     end )as totaldctogastos, 
    sum  
        (case linefact.tipo  
        when 'ANTICIPO' then  
        isnull(salidaeuro,0) 
        else 0 
        end  )as totalsalidaanticipos, 
       sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
    case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0)  
        when 0 then 
        isnull(salidaeuro,0) 
      else 0  
        end 
     else 0 
      end  
     else 0  
     end )as totalsalidahonorarios, 
     sum 
     (case linefact.tipo 
    when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(salidaeuro,0) 
      else 0  
      end 
     else 0  
    end )as totalsalidaarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0)  
     when 1 then 
      isnull(salidaeuro,0)  
     else 0 
      end 
     else 0  
     end )as totalsalidagastos,                                                 
linefact.inumfactura as linefactinumfactura, linefact.yearfact as linefactyearfact, linefact.serie as linefactserie, linefact.codsubusu as linefactcodsubusu from linefact
left join cuencli c on c.icodcli=linefact.inumexpexho and c.dfecha =linefact.fechaconcep and c.linea  = linefact.lineacuentas
where (linefact.tipo = 'HONORARIO' or linefact.tipo = 'ANTICIPO')
group by linefact.inumfactura, linefact.yearfact,  linefact.serie, linefact.codsubusu)
as tbliva on tbliva.linefactinumfactura=facturas.inumfactura and tbliva.linefactyearfact=facturas.yearfact and tbliva.linefactcodsubusu=facturas.codsubusu and tbliva.linefactserie=facturas.serie
where facturas.inumfactura = @inumfactura and facturas.yearfact = @yearfact and facturas.codsubusu = @codsubusu and facturas.serie like @serie ",sourcedatosfact
328,45,qrylinefact,"select (linefact.descripcion + ' ' + isnull(cast(linefact.notas as varchar(MAX)),' ')) as descripnotas, (isnull(entradaeuro,0)+isnull(salidaeuro,0)) as importe,(isnull(salidaeuro,0)-isnull(totaldctoeuro,0)) as salidamenosdcto, linefact.descripcion,linefact.salidaeuro, s.nombre as usuario,
(round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0)) -
round((round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0))*(isnull(linefact.dctolinea2,0)/100),2) as honocondcto1dcto2,
art.referencia as referenciaart,linefact.origen,c.idartstock,c.honogasto,
(case linefact.tipoproformarel
 when 0 then 'Oficial'
 when 1 then 'Pro forma'
 when 2 then 'Presupuesto'
 when 3 then 'Albarán'
 when 4 then 'Pedido'
 When 5 then 'Orden'
 else ''
 end) as TipoDoc
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.porrecargo)/100) as cuotarec
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.poriva)/100) as cuotaivasinrec
,art.campo1,art.campo2,art.campo3,art.campo4,art.campo5,art.campo6,art.campo7,art.campo8
,art.campofecha1,art.campofecha2,art.campofecha3,art.campofecha4,art.notas as notasArt,
case when linefact.unidades=0 then linefact.fpreciounitario
else cast(round(isnull(linefact.fpreciounitario,0)-(isnull(linefact.totaldctoeuro,0)/isnull(linefact.unidades,1)),2) as money) end as preciounimenosdcto,
c.numexpediente  , case (isnull(cm.snombrecli, ''))
when '' then
	case (isnull(cliseg.snombrecli, ''))
	when '' then clisegclider.snombrecli
	else cliseg.snombrecli
	end
else cm.snombrecli
end
as pacientenombre from linefact
left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea 
left join subusu s on c.subusu=s.icodsubusu 
left join articulos art on c.idartstock=art.id left join controlmutua cm on linefact.linea = cm.linefact and linefact.inumfactura = cm.inumfactura and linefact.yearfact = cm.yearfact and linefact.codsubusu=cm.codsubusu and linefact.serie=cm.serie 
and linefact.fechaconcep=cm.dfechaconceptofact
left join segcli_cuencli segcuen on linefact.Origen = 'cli' and segcuen.icodcli_cuencli=linefact.inumexpexho and segcuen.linea_cuencli=linefact.lineacuentas and segcuen.dfecha_cuencli=linefact.fechaconcep
left join clientes cliseg on cliseg.icodcli=segcuen.icodcli_segcli
left join cuenclisegclider on linefact.origen = 'cli' and cuenclisegclider.icodclicuencli=linefact.inumexpexho and cuenclisegclider.dfechacuencli=linefact.fechaconcep and cuenclisegclider.lineacuencli=linefact.lineacuentas
left join segclider on segclider.id=cuenclisegclider.idsegclider and segclider.icodcli<>linefact.inumexpexho
left join clientes clisegclider on clisegclider.icodcli=segclider.icodcli  where linefact.inumfactura = @inumfactura and linefact.yearfact = @yearfact and linefact.codsubusu = @codsubusu and linefact.serie = @serie order by linefact.numero",sourcedatosfact
329,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
329,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
329,73,qryoporcli,"select oporcli.*,subusu.nombre as subusuario, ISNULL(C.snombrecli, E.descripcion) as asociadoa from oporcli
left join subusu on oporcli.icodusu=subusu.icodsubusu
left join clientes C on oporcli.icodcliRelacionado = C.icodcli
left join expedien E on oporcli.inumexp = E.inumexp AND oporcli.iyear = E.iyear where oporcli.icodopor = @icodopor",
329,77,qryoporcuentas,"select oporcuentas.*, subusu.nombre as subusuario,
(oporcuentas.oportunidad + ' ' + isnull(cast(oporcuentas.notas as varchar(MAX)),' ')) as conceptonotas
 ,round(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * (ISNULL(poriva, 0) + ISNULL(porrecargo, 0)))/100,2) as totaliva 
    ,round(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * isnull(irpf,0))/100,2) as totalirpf 
    ,round((isnull(importecierre,0) -(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * isnull(irpf,0))/100) + 
(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * (ISNULL(poriva, 0) + ISNULL(porrecargo, 0)))/100)),2) as total 
from oporcuentas
left join subusu on oporcuentas.icodusu=subusu.icodsubusu
where oporcuentas.icodopor = @icodopor order by oporcuentas.orden ",
330,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
330,4,qrycli,"select clientes.nmandato,clientes.snombrecli,clientes.sdomiciliocli,clientes.scodpostalcli,clientes.spoblacioncli,clientes.snombrepais,clientes.iban,clientes.bicswift, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
331,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
331,78,qryprevcobros,"SELECT prevcobros.fechaingreso as fechagasing,prevcobros.nombrecli as cliente,
prevcobros.cobrado as realizada,prevcobros.fechacobro as fecharealizada,
prevcobros.inumfactura as inumfact,prevcobros.ctacliente as ctaacrcli,
prevcobros.ctaingreso as ctagasing, 1 as tipo,
(case prevcobros.factura when 1 then 'Factura Oficial' when 2 then
(case prevcobros.tipoprof when 2 then 'Presupuesto' when 3 then 'Albarán'
else 'Factura Proforma' end)
else '' end) as tipofactura,
l.fecha as fecharemesa,
(case isnull(l.fecha, '') when '' then 0 else 1 end) as estaremesado,
r.banco as banco,
(case prevcobros.factura when 1 then f.fecha when 2 then prof.fecha end) as fechafact,
f.tipologia1 as tip1,f.tipologia2 as tip2,f.tipologia3 as tip3,
cli.fechaalta as fechaaltacliente, null,prevcobros.concepto,prevcobros.total,centrospredef.sdescripcion,prevcobros.total as totalletra ,s.nombre as usuario, cp2.sdescripcion as sdescripcioncentrospredef ,vistapac.pacientenombre  FROM prevcobros
left join linereme l on l.idprevcobros=prevcobros.id
left join remesas r on l.idremesa=r.idremesa
left join facturas f on f.yearfact=prevcobros.yearfact and f.inumfactura=prevcobros.inumfactura and
f.codsubusu=prevcobros.subusufact and f.serie=prevcobros.serie
left join proforma prof on prof.yearfact=prevcobros.yearfact and prof.inumfactura=prevcobros.inumfactura and
prof.codsubusu=prevcobros.subusufact and prof.tipoprof=prevcobros.tipoprof
left join clientes cli on prevcobros.inumexp=cli.icodcli and prevcobros.origen = 'cli'
left join centrospredef on centrospredef.id=cli.idcentros
left join centrospredef cp2 on cp2.id=prevcobros.idcentros
left join subusu s on prevcobros.codsubusu=s.icodsubusu left join vListadoCobrosPacientes vistapac on vistapac.id=prevcobros.id  where prevcobros.id = @id ",sourcedatosfact
332,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
332,4,qrycli,"select clientes.snombrecli,clientes.snifcli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
334,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
334,4,qrycli,"select clientes.snombrecli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
335,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
335,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.scodpostalcli,clientes.spoblacioncli,clientes.sprovinciacli,clientes.stelefonocli,clientes.smovilcli,clientes.telefono2,clientes.sfaxcli,clientes.telefono3,clientes.email, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
335,35,qryseg,"select null,segcli.sactuacion,segcli.notas, segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero,
CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo, isnull(coleg.numcolegiado,'') as numcolegusuact  , ecita.descripcion as estadosalaespera  from segcli left join subusu on segcli.subusu=subusu.icodsubusu
left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1
left join clientes on st.icodtercero=clientes.icodcli
left join vlistadobonos on vlistadobonos.id = segcli.idbono
left join clientes coleg on segcli.subusu =coleg.codsubusu and coleg.tipobd=1  left join estadosCita ecita on ecita.id=segcli.idEstadoCita where segcli.icodcli = @icodcli and tipoactu <> 'Aviso' order by segcli.dfechaact,segcli.horainiact",
335,37,qrysubusu,"SELECT subusu.nombre ,tra.especialidad AS especialidadtra  ,tra.numcolegiado as numcolegiadotra  FROM subusu LEFT JOIN clientes ON subusu.icodsubusu=clientes.codsubusu   LEFT JOIN clientes tra ON subusu.icodsubusu=tra.CodSubUSu AND tra.tipobd=1  WHERE clientes.icodcli = @icodcli",
336,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
336,4,qrycli,"select clientes.snombrecli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
337,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
337,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.telefono3,clientes.email,clientes.pagweb,clientes.codigo,clientes.fechaalta, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
337,21,qrycontact,"select contacto.nombre,contacto.telefono1,contacto.email1 from clientes inner join contactlin on clientes.icodcli = contactlin.icodcli inner join contacto on contactlin.icodcontacto = contacto.codcontacto where clientes.icodcli = @icodcli",
337,37,qrysubusu,"SELECT subusu.nombre ,tra.especialidad AS especialidadtra  ,tra.numcolegiado as numcolegiadotra  FROM subusu LEFT JOIN clientes ON subusu.icodsubusu=clientes.codsubusu   LEFT JOIN clientes tra ON subusu.icodsubusu=tra.CodSubUSu AND tra.tipobd=1  WHERE clientes.icodcli = @icodcli",
338,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
338,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.scodpostalcli,clientes.spoblacioncli,clientes.sprovinciacli,clientes.stelefonocli,clientes.smovilcli,clientes.sfaxcli,clientes.telefono2,clientes.email, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
338,35,qryseg,"select null,segcli.sactuacion,segcli.notas, segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero,
CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo, isnull(coleg.numcolegiado,'') as numcolegusuact  , ecita.descripcion as estadosalaespera  from segcli left join subusu on segcli.subusu=subusu.icodsubusu
left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1
left join clientes on st.icodtercero=clientes.icodcli
left join vlistadobonos on vlistadobonos.id = segcli.idbono
left join clientes coleg on segcli.subusu =coleg.codsubusu and coleg.tipobd=1  left join estadosCita ecita on ecita.id=segcli.idEstadoCita where segcli.icodcli = @icodcli and tipoactu <> 'Aviso' order by segcli.dfechaact,segcli.horainiact",
338,37,qrysubusu,"SELECT subusu.nombre ,tra.especialidad AS especialidadtra  ,tra.numcolegiado as numcolegiadotra  FROM subusu LEFT JOIN clientes ON subusu.icodsubusu=clientes.codsubusu   LEFT JOIN clientes tra ON subusu.icodsubusu=tra.CodSubUSu AND tra.tipobd=1  WHERE clientes.icodcli = @icodcli",
339,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
339,4,qrycli,"select clientes.nmandato,clientes.snombrecli,clientes.sdomiciliocli,clientes.scodpostalcli,clientes.spoblacioncli,clientes.snombrepais,clientes.iban,clientes.bicswift, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
340,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
340,4,qrycli,"select clientes.snombrecli,clientes.snifcli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
341,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
341,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
341,73,qryoporcli,"select oporcli.*,subusu.nombre as subusuario, ISNULL(C.snombrecli, E.descripcion) as asociadoa from oporcli
left join subusu on oporcli.icodusu=subusu.icodsubusu
left join clientes C on oporcli.icodcliRelacionado = C.icodcli
left join expedien E on oporcli.inumexp = E.inumexp AND oporcli.iyear = E.iyear where oporcli.icodopor = @icodopor",
341,77,qryoporcuentas,"select oporcuentas.*, subusu.nombre as subusuario,
(oporcuentas.oportunidad + ' ' + isnull(cast(oporcuentas.notas as varchar(MAX)),' ')) as conceptonotas
 ,round(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * (ISNULL(poriva, 0) + ISNULL(porrecargo, 0)))/100,2) as totaliva 
    ,round(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * isnull(irpf,0))/100,2) as totalirpf 
    ,round((isnull(importecierre,0) -(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * isnull(irpf,0))/100) + 
(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * (ISNULL(poriva, 0) + ISNULL(porrecargo, 0)))/100)),2) as total 
from oporcuentas
left join subusu on oporcuentas.icodusu=subusu.icodsubusu
where oporcuentas.icodopor = @icodopor order by oporcuentas.orden ",
342,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
342,4,qrycli,"select clientes.snombrecli,clientes.snifcli,clientes.sdomiciliocli,clientes.spoblacioncli,clientes.scodpostalcli,clientes.sprovinciacli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
342,73,qryoporcli,"select oporcli.*,subusu.nombre as subusuario, ISNULL(C.snombrecli, E.descripcion) as asociadoa from oporcli
left join subusu on oporcli.icodusu=subusu.icodsubusu
left join clientes C on oporcli.icodcliRelacionado = C.icodcli
left join expedien E on oporcli.inumexp = E.inumexp AND oporcli.iyear = E.iyear where oporcli.icodopor = @icodopor",
342,77,qryoporcuentas,"select oporcuentas.*, subusu.nombre as subusuario,
(oporcuentas.oportunidad + ' ' + isnull(cast(oporcuentas.notas as varchar(MAX)),' ')) as conceptonotas
 ,round(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * (ISNULL(poriva, 0) + ISNULL(porrecargo, 0)))/100,2) as totaliva 
    ,round(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * isnull(irpf,0))/100,2) as totalirpf 
    ,round((isnull(importecierre,0) -(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * isnull(irpf,0))/100) + 
(((isnull(prevision,0) -((isnull(prevision,0)*isnull(dctolinea,0))/100)) * (ISNULL(poriva, 0) + ISNULL(porrecargo, 0)))/100)),2) as total 
from oporcuentas
left join subusu on oporcuentas.icodusu=subusu.icodsubusu
where oporcuentas.icodopor = @icodopor order by oporcuentas.orden ",
343,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
343,32,qryfact,"select ((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalbaseivairpf,((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro) as totalbaseiva,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0) + facturas.totalivaeuro) as totalhonodctoiva,
(isnull(facturas.totalderechoseuro,0) - isnull(facturas.totanticipos,0)) as totderechomenosanticipo,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) as totalbaseimp,
(facturas.totalsuplidoseuro + (facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalminuta, facturas.nombrecli,facturas.nifcli,facturas.domiciliocli,facturas.poblacioncli,facturas.codpostalcli,facturas.provinciacli,facturas.inumfactura,facturas.serie,facturas.fecha,facturas.totaldctoeuro,facturas.totaleuro,(substring(facturas.cuentabanco,1,4) + '************' + substring(facturas.cuentabanco,17,4)) as cuentabancocifr,
(substring(facturas.iban,1,8) + replicate('*',LEN(facturas.iban)-8)) as ibancifr,(datename(day,facturas.fecha) + ' de ' + datename(month, facturas.fecha) + ' de ' + datename(year,facturas.fecha)) as fechafacturalarga,
(f2.totalderechoseuro - isnull(f2.totaldctoeuro,0)) as totalbaseimpAbo,f2.TotalIvaEuro as totalivaAbo,f2.TotalEuro as totaleuroabo,
(((isnull(facturas.honocondctolin,0) - isnull(facturas.totsolodctofact,0)) + isnull(facturas.totportes,0))) as baseConPortes,pl.descripcion as descplazo,
(select sum(isnull(salidaeuro,0)) - sum(isnull(totaldctoeuro,0)) FROM linefact
	left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea
	where (tipo = 'HONORARIO') AND (ISNULL(honogasto,0) = 0) and (ISNULL(bhonoarticulo,0) = 0) and (ISNULL(bhonodcto,0) = 0)
	and facturas.inumfactura = linefact.inumfactura and facturas.yearfact=linefact.yearfact and facturas.codsubusu=linefact.codsubusu and facturas.serie=linefact.serie) as totbaseimpsolohono,
(isnull(facturas.TotalEuro,0)) as totalletra, totalivaanticipos,totalivahonorarios,totalivaarticulos
 ,totalivagastos, totaldctoanticipos, totaldctohonorarios, totaldctoarticulos, totaldctogastos, 
totalsalidaanticipos, totalsalidahonorarios, totalsalidaarticulos, totalsalidagastos, 
(totalsalidaanticipos - totaldctoanticipos + totalivaanticipos) as totmenosdctomasivaanticipos, 
(totalsalidahonorarios - totaldctohonorarios + totalivahonorarios) as totmenosdctomasivahonorarios, 
(totalsalidaarticulos - totaldctoarticulos + totalivaarticulos) as totmenosdctomasivaarticulos, 
(totalsalidagastos - totaldctogastos + totalivagastos) as totmenosdctomasivagastos, identificadorTBAI
from facturas
left join facturas f2 on facturas.yearfactabonada=f2.yearfact and facturas.inumfactabonada=f2.inumfactura and facturas.serieabonada=f2.serie
left join facturasTicketBai ft on facturas.yearfact = ft.yearfact and facturas.inumfactura = ft.inumfactura and facturas.codsubusu = ft.codsubusu and facturas.serie = ft.serie
left join plazosc pl on pl.id = facturas.idplazos
left join
(select
	sum
	(
	case linefact.tipo
	when 'ANTICIPO' then
	isnull(totalivaeuro,0)
	else 0
	end) as totalivaanticipos,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.honogasto,0)
		when 0 then
			case ISNULL(c.bhonoarticulo,0)
			when 0 then
			isnull(totalivaeuro,0)
			else 0
			end
		else 0
		end
	else 0
	end) as totalivahonorarios,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.bhonoarticulo,0)
		when 1 then
		isnull(totalivaeuro,0)
		else 0
		end
	else 0
	end) as totalivaarticulos,
    sum  
    (   
     case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totalivaeuro,0) 
     else 0  
      end  
     else 0  
     end )as totalivagastos, 
     sum  
     (  
     case linefact.tipo 
     when 'ANTICIPO' then 
     isnull(totaldctoeuro,0) 
     else 0  
     end  )as totaldctoanticipos, 
     sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
     case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0) 
        when 0 then  
        isnull(totaldctoeuro,0) 
      else 0 
       end 
     else 0  
      end  
     else 0 
     end )as totaldctohonorarios, 
     sum 
     (case linefact.tipo 
     when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(totaldctoeuro,0) 
      else 0 
      end  
     else 0 
    end )as totaldctoarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totaldctoeuro,0) 
     else 0  
      end  
     else 0  
     end )as totaldctogastos, 
    sum  
        (case linefact.tipo  
        when 'ANTICIPO' then  
        isnull(salidaeuro,0) 
        else 0 
        end  )as totalsalidaanticipos, 
       sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
    case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0)  
        when 0 then 
        isnull(salidaeuro,0) 
      else 0  
        end 
     else 0 
      end  
     else 0  
     end )as totalsalidahonorarios, 
     sum 
     (case linefact.tipo 
    when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(salidaeuro,0) 
      else 0  
      end 
     else 0  
    end )as totalsalidaarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0)  
     when 1 then 
      isnull(salidaeuro,0)  
     else 0 
      end 
     else 0  
     end )as totalsalidagastos,                                                 
linefact.inumfactura as linefactinumfactura, linefact.yearfact as linefactyearfact, linefact.serie as linefactserie, linefact.codsubusu as linefactcodsubusu from linefact
left join cuencli c on c.icodcli=linefact.inumexpexho and c.dfecha =linefact.fechaconcep and c.linea  = linefact.lineacuentas
where (linefact.tipo = 'HONORARIO' or linefact.tipo = 'ANTICIPO')
group by linefact.inumfactura, linefact.yearfact,  linefact.serie, linefact.codsubusu)
as tbliva on tbliva.linefactinumfactura=facturas.inumfactura and tbliva.linefactyearfact=facturas.yearfact and tbliva.linefactcodsubusu=facturas.codsubusu and tbliva.linefactserie=facturas.serie
where facturas.inumfactura = @inumfactura and facturas.yearfact = @yearfact and facturas.codsubusu = @codsubusu and facturas.serie like @serie ",sourcedatosfact
343,45,qrylinefact,"select (linefact.descripcion + ' ' + isnull(cast(linefact.notas as varchar(MAX)),' ')) as descripnotas, (isnull(entradaeuro,0)+isnull(salidaeuro,0)) as importe,(isnull(salidaeuro,0)-isnull(totaldctoeuro,0)) as salidamenosdcto, linefact.descripcion,linefact.salidaeuro, s.nombre as usuario,
(round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0)) -
round((round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0))*(isnull(linefact.dctolinea2,0)/100),2) as honocondcto1dcto2,
art.referencia as referenciaart,linefact.origen,c.idartstock,c.honogasto,
(case linefact.tipoproformarel
 when 0 then 'Oficial'
 when 1 then 'Pro forma'
 when 2 then 'Presupuesto'
 when 3 then 'Albarán'
 when 4 then 'Pedido'
 When 5 then 'Orden'
 else ''
 end) as TipoDoc
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.porrecargo)/100) as cuotarec
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.poriva)/100) as cuotaivasinrec
,art.campo1,art.campo2,art.campo3,art.campo4,art.campo5,art.campo6,art.campo7,art.campo8
,art.campofecha1,art.campofecha2,art.campofecha3,art.campofecha4,art.notas as notasArt,
case when linefact.unidades=0 then linefact.fpreciounitario
else cast(round(isnull(linefact.fpreciounitario,0)-(isnull(linefact.totaldctoeuro,0)/isnull(linefact.unidades,1)),2) as money) end as preciounimenosdcto,
c.numexpediente  , case (isnull(cm.snombrecli, ''))
when '' then
	case (isnull(cliseg.snombrecli, ''))
	when '' then clisegclider.snombrecli
	else cliseg.snombrecli
	end
else cm.snombrecli
end
as pacientenombre from linefact
left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea 
left join subusu s on c.subusu=s.icodsubusu 
left join articulos art on c.idartstock=art.id left join controlmutua cm on linefact.linea = cm.linefact and linefact.inumfactura = cm.inumfactura and linefact.yearfact = cm.yearfact and linefact.codsubusu=cm.codsubusu and linefact.serie=cm.serie 
and linefact.fechaconcep=cm.dfechaconceptofact
left join segcli_cuencli segcuen on linefact.Origen = 'cli' and segcuen.icodcli_cuencli=linefact.inumexpexho and segcuen.linea_cuencli=linefact.lineacuentas and segcuen.dfecha_cuencli=linefact.fechaconcep
left join clientes cliseg on cliseg.icodcli=segcuen.icodcli_segcli
left join cuenclisegclider on linefact.origen = 'cli' and cuenclisegclider.icodclicuencli=linefact.inumexpexho and cuenclisegclider.dfechacuencli=linefact.fechaconcep and cuenclisegclider.lineacuencli=linefact.lineacuentas
left join segclider on segclider.id=cuenclisegclider.idsegclider and segclider.icodcli<>linefact.inumexpexho
left join clientes clisegclider on clisegclider.icodcli=segclider.icodcli  where linefact.inumfactura = @inumfactura and linefact.yearfact = @yearfact and linefact.codsubusu = @codsubusu and linefact.serie = @serie order by linefact.numero",sourcedatosfact
344,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
344,32,qryfact,"select ((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalbaseivairpf,((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro) as totalbaseiva,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0) + facturas.totalivaeuro) as totalhonodctoiva,
(isnull(facturas.totalderechoseuro,0) - isnull(facturas.totanticipos,0)) as totderechomenosanticipo,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) as totalbaseimp,
(facturas.totalsuplidoseuro + (facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalminuta, facturas.nombrecli,facturas.nifcli,facturas.domiciliocli,facturas.poblacioncli,facturas.codpostalcli,facturas.provinciacli,facturas.inumfactura,facturas.serie,facturas.fecha,facturas.totaldctoeuro,facturas.iva,facturas.totalivaeuro,facturas.totaleuro,(substring(facturas.cuentabanco,1,4) + '************' + substring(facturas.cuentabanco,17,4)) as cuentabancocifr,
(substring(facturas.iban,1,8) + replicate('*',LEN(facturas.iban)-8)) as ibancifr,(datename(day,facturas.fecha) + ' de ' + datename(month, facturas.fecha) + ' de ' + datename(year,facturas.fecha)) as fechafacturalarga,
(f2.totalderechoseuro - isnull(f2.totaldctoeuro,0)) as totalbaseimpAbo,f2.TotalIvaEuro as totalivaAbo,f2.TotalEuro as totaleuroabo,
(((isnull(facturas.honocondctolin,0) - isnull(facturas.totsolodctofact,0)) + isnull(facturas.totportes,0))) as baseConPortes,pl.descripcion as descplazo,
(select sum(isnull(salidaeuro,0)) - sum(isnull(totaldctoeuro,0)) FROM linefact
	left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea
	where (tipo = 'HONORARIO') AND (ISNULL(honogasto,0) = 0) and (ISNULL(bhonoarticulo,0) = 0) and (ISNULL(bhonodcto,0) = 0)
	and facturas.inumfactura = linefact.inumfactura and facturas.yearfact=linefact.yearfact and facturas.codsubusu=linefact.codsubusu and facturas.serie=linefact.serie) as totbaseimpsolohono,
(isnull(facturas.TotalEuro,0)) as totalletra, totalivaanticipos,totalivahonorarios,totalivaarticulos
 ,totalivagastos, totaldctoanticipos, totaldctohonorarios, totaldctoarticulos, totaldctogastos, 
totalsalidaanticipos, totalsalidahonorarios, totalsalidaarticulos, totalsalidagastos, 
(totalsalidaanticipos - totaldctoanticipos + totalivaanticipos) as totmenosdctomasivaanticipos, 
(totalsalidahonorarios - totaldctohonorarios + totalivahonorarios) as totmenosdctomasivahonorarios, 
(totalsalidaarticulos - totaldctoarticulos + totalivaarticulos) as totmenosdctomasivaarticulos, 
(totalsalidagastos - totaldctogastos + totalivagastos) as totmenosdctomasivagastos, identificadorTBAI
from facturas
left join facturas f2 on facturas.yearfactabonada=f2.yearfact and facturas.inumfactabonada=f2.inumfactura and facturas.serieabonada=f2.serie
left join facturasTicketBai ft on facturas.yearfact = ft.yearfact and facturas.inumfactura = ft.inumfactura and facturas.codsubusu = ft.codsubusu and facturas.serie = ft.serie
left join plazosc pl on pl.id = facturas.idplazos
left join
(select
	sum
	(
	case linefact.tipo
	when 'ANTICIPO' then
	isnull(totalivaeuro,0)
	else 0
	end) as totalivaanticipos,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.honogasto,0)
		when 0 then
			case ISNULL(c.bhonoarticulo,0)
			when 0 then
			isnull(totalivaeuro,0)
			else 0
			end
		else 0
		end
	else 0
	end) as totalivahonorarios,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.bhonoarticulo,0)
		when 1 then
		isnull(totalivaeuro,0)
		else 0
		end
	else 0
	end) as totalivaarticulos,
    sum  
    (   
     case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totalivaeuro,0) 
     else 0  
      end  
     else 0  
     end )as totalivagastos, 
     sum  
     (  
     case linefact.tipo 
     when 'ANTICIPO' then 
     isnull(totaldctoeuro,0) 
     else 0  
     end  )as totaldctoanticipos, 
     sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
     case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0) 
        when 0 then  
        isnull(totaldctoeuro,0) 
      else 0 
       end 
     else 0  
      end  
     else 0 
     end )as totaldctohonorarios, 
     sum 
     (case linefact.tipo 
     when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(totaldctoeuro,0) 
      else 0 
      end  
     else 0 
    end )as totaldctoarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totaldctoeuro,0) 
     else 0  
      end  
     else 0  
     end )as totaldctogastos, 
    sum  
        (case linefact.tipo  
        when 'ANTICIPO' then  
        isnull(salidaeuro,0) 
        else 0 
        end  )as totalsalidaanticipos, 
       sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
    case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0)  
        when 0 then 
        isnull(salidaeuro,0) 
      else 0  
        end 
     else 0 
      end  
     else 0  
     end )as totalsalidahonorarios, 
     sum 
     (case linefact.tipo 
    when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(salidaeuro,0) 
      else 0  
      end 
     else 0  
    end )as totalsalidaarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0)  
     when 1 then 
      isnull(salidaeuro,0)  
     else 0 
      end 
     else 0  
     end )as totalsalidagastos,                                                 
linefact.inumfactura as linefactinumfactura, linefact.yearfact as linefactyearfact, linefact.serie as linefactserie, linefact.codsubusu as linefactcodsubusu from linefact
left join cuencli c on c.icodcli=linefact.inumexpexho and c.dfecha =linefact.fechaconcep and c.linea  = linefact.lineacuentas
where (linefact.tipo = 'HONORARIO' or linefact.tipo = 'ANTICIPO')
group by linefact.inumfactura, linefact.yearfact,  linefact.serie, linefact.codsubusu)
as tbliva on tbliva.linefactinumfactura=facturas.inumfactura and tbliva.linefactyearfact=facturas.yearfact and tbliva.linefactcodsubusu=facturas.codsubusu and tbliva.linefactserie=facturas.serie
where facturas.inumfactura = @inumfactura and facturas.yearfact = @yearfact and facturas.codsubusu = @codsubusu and facturas.serie like @serie ",sourcedatosfact
344,45,qrylinefact,"select (linefact.descripcion + ' ' + isnull(cast(linefact.notas as varchar(MAX)),' ')) as descripnotas, (isnull(entradaeuro,0)+isnull(salidaeuro,0)) as importe,(isnull(salidaeuro,0)-isnull(totaldctoeuro,0)) as salidamenosdcto, linefact.unidades,linefact.descripcion,linefact.fpreciounitario,linefact.dctolinea,linefact.iva,linefact.totaleuro, s.nombre as usuario,
(round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0)) -
round((round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0))*(isnull(linefact.dctolinea2,0)/100),2) as honocondcto1dcto2,
art.referencia as referenciaart,linefact.origen,c.idartstock,c.honogasto,
(case linefact.tipoproformarel
 when 0 then 'Oficial'
 when 1 then 'Pro forma'
 when 2 then 'Presupuesto'
 when 3 then 'Albarán'
 when 4 then 'Pedido'
 When 5 then 'Orden'
 else ''
 end) as TipoDoc
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.porrecargo)/100) as cuotarec
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.poriva)/100) as cuotaivasinrec
,art.campo1,art.campo2,art.campo3,art.campo4,art.campo5,art.campo6,art.campo7,art.campo8
,art.campofecha1,art.campofecha2,art.campofecha3,art.campofecha4,art.notas as notasArt,
case when linefact.unidades=0 then linefact.fpreciounitario
else cast(round(isnull(linefact.fpreciounitario,0)-(isnull(linefact.totaldctoeuro,0)/isnull(linefact.unidades,1)),2) as money) end as preciounimenosdcto,
c.numexpediente  , case (isnull(cm.snombrecli, ''))
when '' then
	case (isnull(cliseg.snombrecli, ''))
	when '' then clisegclider.snombrecli
	else cliseg.snombrecli
	end
else cm.snombrecli
end
as pacientenombre from linefact
left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea 
left join subusu s on c.subusu=s.icodsubusu 
left join articulos art on c.idartstock=art.id left join controlmutua cm on linefact.linea = cm.linefact and linefact.inumfactura = cm.inumfactura and linefact.yearfact = cm.yearfact and linefact.codsubusu=cm.codsubusu and linefact.serie=cm.serie 
and linefact.fechaconcep=cm.dfechaconceptofact
left join segcli_cuencli segcuen on linefact.Origen = 'cli' and segcuen.icodcli_cuencli=linefact.inumexpexho and segcuen.linea_cuencli=linefact.lineacuentas and segcuen.dfecha_cuencli=linefact.fechaconcep
left join clientes cliseg on cliseg.icodcli=segcuen.icodcli_segcli
left join cuenclisegclider on linefact.origen = 'cli' and cuenclisegclider.icodclicuencli=linefact.inumexpexho and cuenclisegclider.dfechacuencli=linefact.fechaconcep and cuenclisegclider.lineacuencli=linefact.lineacuentas
left join segclider on segclider.id=cuenclisegclider.idsegclider and segclider.icodcli<>linefact.inumexpexho
left join clientes clisegclider on clisegclider.icodcli=segclider.icodcli  where linefact.inumfactura = @inumfactura and linefact.yearfact = @yearfact and linefact.codsubusu = @codsubusu and linefact.serie = @serie order by linefact.numero",sourcedatosfact
345,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
345,32,qryfact,"select ((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalbaseivairpf,((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro) as totalbaseiva,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0) + facturas.totalivaeuro) as totalhonodctoiva,
(isnull(facturas.totalderechoseuro,0) - isnull(facturas.totanticipos,0)) as totderechomenosanticipo,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) as totalbaseimp,
(facturas.totalsuplidoseuro + (facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalminuta, facturas.nombrecli,facturas.nifcli,facturas.domiciliocli,facturas.poblacioncli,facturas.codpostalcli,facturas.provinciacli,facturas.inumfactura,facturas.serie,facturas.fecha,facturas.totaldctoeuro,facturas.iva,facturas.totalivaeuro,facturas.totaleuro,(substring(facturas.cuentabanco,1,4) + '************' + substring(facturas.cuentabanco,17,4)) as cuentabancocifr,
(substring(facturas.iban,1,8) + replicate('*',LEN(facturas.iban)-8)) as ibancifr,(datename(day,facturas.fecha) + ' de ' + datename(month, facturas.fecha) + ' de ' + datename(year,facturas.fecha)) as fechafacturalarga,
(f2.totalderechoseuro - isnull(f2.totaldctoeuro,0)) as totalbaseimpAbo,f2.TotalIvaEuro as totalivaAbo,f2.TotalEuro as totaleuroabo,
(((isnull(facturas.honocondctolin,0) - isnull(facturas.totsolodctofact,0)) + isnull(facturas.totportes,0))) as baseConPortes,pl.descripcion as descplazo,
(select sum(isnull(salidaeuro,0)) - sum(isnull(totaldctoeuro,0)) FROM linefact
	left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea
	where (tipo = 'HONORARIO') AND (ISNULL(honogasto,0) = 0) and (ISNULL(bhonoarticulo,0) = 0) and (ISNULL(bhonodcto,0) = 0)
	and facturas.inumfactura = linefact.inumfactura and facturas.yearfact=linefact.yearfact and facturas.codsubusu=linefact.codsubusu and facturas.serie=linefact.serie) as totbaseimpsolohono,
(isnull(facturas.TotalEuro,0)) as totalletra, totalivaanticipos,totalivahonorarios,totalivaarticulos
 ,totalivagastos, totaldctoanticipos, totaldctohonorarios, totaldctoarticulos, totaldctogastos, 
totalsalidaanticipos, totalsalidahonorarios, totalsalidaarticulos, totalsalidagastos, 
(totalsalidaanticipos - totaldctoanticipos + totalivaanticipos) as totmenosdctomasivaanticipos, 
(totalsalidahonorarios - totaldctohonorarios + totalivahonorarios) as totmenosdctomasivahonorarios, 
(totalsalidaarticulos - totaldctoarticulos + totalivaarticulos) as totmenosdctomasivaarticulos, 
(totalsalidagastos - totaldctogastos + totalivagastos) as totmenosdctomasivagastos, identificadorTBAI
from facturas
left join facturas f2 on facturas.yearfactabonada=f2.yearfact and facturas.inumfactabonada=f2.inumfactura and facturas.serieabonada=f2.serie
left join facturasTicketBai ft on facturas.yearfact = ft.yearfact and facturas.inumfactura = ft.inumfactura and facturas.codsubusu = ft.codsubusu and facturas.serie = ft.serie
left join plazosc pl on pl.id = facturas.idplazos
left join
(select
	sum
	(
	case linefact.tipo
	when 'ANTICIPO' then
	isnull(totalivaeuro,0)
	else 0
	end) as totalivaanticipos,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.honogasto,0)
		when 0 then
			case ISNULL(c.bhonoarticulo,0)
			when 0 then
			isnull(totalivaeuro,0)
			else 0
			end
		else 0
		end
	else 0
	end) as totalivahonorarios,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.bhonoarticulo,0)
		when 1 then
		isnull(totalivaeuro,0)
		else 0
		end
	else 0
	end) as totalivaarticulos,
    sum  
    (   
     case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totalivaeuro,0) 
     else 0  
      end  
     else 0  
     end )as totalivagastos, 
     sum  
     (  
     case linefact.tipo 
     when 'ANTICIPO' then 
     isnull(totaldctoeuro,0) 
     else 0  
     end  )as totaldctoanticipos, 
     sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
     case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0) 
        when 0 then  
        isnull(totaldctoeuro,0) 
      else 0 
       end 
     else 0  
      end  
     else 0 
     end )as totaldctohonorarios, 
     sum 
     (case linefact.tipo 
     when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(totaldctoeuro,0) 
      else 0 
      end  
     else 0 
    end )as totaldctoarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totaldctoeuro,0) 
     else 0  
      end  
     else 0  
     end )as totaldctogastos, 
    sum  
        (case linefact.tipo  
        when 'ANTICIPO' then  
        isnull(salidaeuro,0) 
        else 0 
        end  )as totalsalidaanticipos, 
       sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
    case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0)  
        when 0 then 
        isnull(salidaeuro,0) 
      else 0  
        end 
     else 0 
      end  
     else 0  
     end )as totalsalidahonorarios, 
     sum 
     (case linefact.tipo 
    when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(salidaeuro,0) 
      else 0  
      end 
     else 0  
    end )as totalsalidaarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0)  
     when 1 then 
      isnull(salidaeuro,0)  
     else 0 
      end 
     else 0  
     end )as totalsalidagastos,                                                 
linefact.inumfactura as linefactinumfactura, linefact.yearfact as linefactyearfact, linefact.serie as linefactserie, linefact.codsubusu as linefactcodsubusu from linefact
left join cuencli c on c.icodcli=linefact.inumexpexho and c.dfecha =linefact.fechaconcep and c.linea  = linefact.lineacuentas
where (linefact.tipo = 'HONORARIO' or linefact.tipo = 'ANTICIPO')
group by linefact.inumfactura, linefact.yearfact,  linefact.serie, linefact.codsubusu)
as tbliva on tbliva.linefactinumfactura=facturas.inumfactura and tbliva.linefactyearfact=facturas.yearfact and tbliva.linefactcodsubusu=facturas.codsubusu and tbliva.linefactserie=facturas.serie
where facturas.inumfactura = @inumfactura and facturas.yearfact = @yearfact and facturas.codsubusu = @codsubusu and facturas.serie like @serie ",sourcedatosfact
345,45,qrylinefact,"select (linefact.descripcion + ' ' + isnull(cast(linefact.notas as varchar(MAX)),' ')) as descripnotas, (isnull(entradaeuro,0)+isnull(salidaeuro,0)) as importe,(isnull(salidaeuro,0)-isnull(totaldctoeuro,0)) as salidamenosdcto, linefact.unidades,linefact.descripcion,linefact.fpreciounitario,linefact.dctolinea,linefact.iva,linefact.totaleuro, s.nombre as usuario,
(round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0)) -
round((round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0))*(isnull(linefact.dctolinea2,0)/100),2) as honocondcto1dcto2,
art.referencia as referenciaart,linefact.origen,c.idartstock,c.honogasto,
(case linefact.tipoproformarel
 when 0 then 'Oficial'
 when 1 then 'Pro forma'
 when 2 then 'Presupuesto'
 when 3 then 'Albarán'
 when 4 then 'Pedido'
 When 5 then 'Orden'
 else ''
 end) as TipoDoc
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.porrecargo)/100) as cuotarec
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.poriva)/100) as cuotaivasinrec
,art.campo1,art.campo2,art.campo3,art.campo4,art.campo5,art.campo6,art.campo7,art.campo8
,art.campofecha1,art.campofecha2,art.campofecha3,art.campofecha4,art.notas as notasArt,
case when linefact.unidades=0 then linefact.fpreciounitario
else cast(round(isnull(linefact.fpreciounitario,0)-(isnull(linefact.totaldctoeuro,0)/isnull(linefact.unidades,1)),2) as money) end as preciounimenosdcto,
c.numexpediente  , case (isnull(cm.snombrecli, ''))
when '' then
	case (isnull(cliseg.snombrecli, ''))
	when '' then clisegclider.snombrecli
	else cliseg.snombrecli
	end
else cm.snombrecli
end
as pacientenombre from linefact
left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea 
left join subusu s on c.subusu=s.icodsubusu 
left join articulos art on c.idartstock=art.id left join controlmutua cm on linefact.linea = cm.linefact and linefact.inumfactura = cm.inumfactura and linefact.yearfact = cm.yearfact and linefact.codsubusu=cm.codsubusu and linefact.serie=cm.serie 
and linefact.fechaconcep=cm.dfechaconceptofact
left join segcli_cuencli segcuen on linefact.Origen = 'cli' and segcuen.icodcli_cuencli=linefact.inumexpexho and segcuen.linea_cuencli=linefact.lineacuentas and segcuen.dfecha_cuencli=linefact.fechaconcep
left join clientes cliseg on cliseg.icodcli=segcuen.icodcli_segcli
left join cuenclisegclider on linefact.origen = 'cli' and cuenclisegclider.icodclicuencli=linefact.inumexpexho and cuenclisegclider.dfechacuencli=linefact.fechaconcep and cuenclisegclider.lineacuencli=linefact.lineacuentas
left join segclider on segclider.id=cuenclisegclider.idsegclider and segclider.icodcli<>linefact.inumexpexho
left join clientes clisegclider on clisegclider.icodcli=segclider.icodcli  where linefact.inumfactura = @inumfactura and linefact.yearfact = @yearfact and linefact.codsubusu = @codsubusu and linefact.serie = @serie order by linefact.numero",sourcedatosfact
345,82,qryclipacientes,"select clipac.snombrecli,convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
				(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr,clipac.icodcli  from clipacientes pac left join clientes clipac on pac.icodpaciente=clipac.icodcli  where pac.icodcli = @icodcli",
346,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
346,32,qryfact,"select ((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalbaseivairpf,((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro) as totalbaseiva,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0) + facturas.totalivaeuro) as totalhonodctoiva,
(isnull(facturas.totalderechoseuro,0) - isnull(facturas.totanticipos,0)) as totderechomenosanticipo,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) as totalbaseimp,
(facturas.totalsuplidoseuro + (facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalminuta, facturas.nombrecli,facturas.nifcli,facturas.domiciliocli,facturas.poblacioncli,facturas.codpostalcli,facturas.provinciacli,facturas.inumfactura,facturas.serie,facturas.fecha,facturas.inumfactabonada,facturas.serieabonada,facturas.fechaabonada,facturas.totaldctoeuro,facturas.iva,facturas.totalivaeuro,facturas.totaleuro,(substring(facturas.cuentabanco,1,4) + '************' + substring(facturas.cuentabanco,17,4)) as cuentabancocifr,
(substring(facturas.iban,1,8) + replicate('*',LEN(facturas.iban)-8)) as ibancifr,(datename(day,facturas.fecha) + ' de ' + datename(month, facturas.fecha) + ' de ' + datename(year,facturas.fecha)) as fechafacturalarga,
(f2.totalderechoseuro - isnull(f2.totaldctoeuro,0)) as totalbaseimpAbo,f2.TotalIvaEuro as totalivaAbo,f2.TotalEuro as totaleuroabo,
(((isnull(facturas.honocondctolin,0) - isnull(facturas.totsolodctofact,0)) + isnull(facturas.totportes,0))) as baseConPortes,pl.descripcion as descplazo,
(select sum(isnull(salidaeuro,0)) - sum(isnull(totaldctoeuro,0)) FROM linefact
	left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea
	where (tipo = 'HONORARIO') AND (ISNULL(honogasto,0) = 0) and (ISNULL(bhonoarticulo,0) = 0) and (ISNULL(bhonodcto,0) = 0)
	and facturas.inumfactura = linefact.inumfactura and facturas.yearfact=linefact.yearfact and facturas.codsubusu=linefact.codsubusu and facturas.serie=linefact.serie) as totbaseimpsolohono,
(isnull(facturas.TotalEuro,0)) as totalletra, totalivaanticipos,totalivahonorarios,totalivaarticulos
 ,totalivagastos, totaldctoanticipos, totaldctohonorarios, totaldctoarticulos, totaldctogastos, 
totalsalidaanticipos, totalsalidahonorarios, totalsalidaarticulos, totalsalidagastos, 
(totalsalidaanticipos - totaldctoanticipos + totalivaanticipos) as totmenosdctomasivaanticipos, 
(totalsalidahonorarios - totaldctohonorarios + totalivahonorarios) as totmenosdctomasivahonorarios, 
(totalsalidaarticulos - totaldctoarticulos + totalivaarticulos) as totmenosdctomasivaarticulos, 
(totalsalidagastos - totaldctogastos + totalivagastos) as totmenosdctomasivagastos, identificadorTBAI
from facturas
left join facturas f2 on facturas.yearfactabonada=f2.yearfact and facturas.inumfactabonada=f2.inumfactura and facturas.serieabonada=f2.serie
left join facturasTicketBai ft on facturas.yearfact = ft.yearfact and facturas.inumfactura = ft.inumfactura and facturas.codsubusu = ft.codsubusu and facturas.serie = ft.serie
left join plazosc pl on pl.id = facturas.idplazos
left join
(select
	sum
	(
	case linefact.tipo
	when 'ANTICIPO' then
	isnull(totalivaeuro,0)
	else 0
	end) as totalivaanticipos,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.honogasto,0)
		when 0 then
			case ISNULL(c.bhonoarticulo,0)
			when 0 then
			isnull(totalivaeuro,0)
			else 0
			end
		else 0
		end
	else 0
	end) as totalivahonorarios,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.bhonoarticulo,0)
		when 1 then
		isnull(totalivaeuro,0)
		else 0
		end
	else 0
	end) as totalivaarticulos,
    sum  
    (   
     case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totalivaeuro,0) 
     else 0  
      end  
     else 0  
     end )as totalivagastos, 
     sum  
     (  
     case linefact.tipo 
     when 'ANTICIPO' then 
     isnull(totaldctoeuro,0) 
     else 0  
     end  )as totaldctoanticipos, 
     sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
     case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0) 
        when 0 then  
        isnull(totaldctoeuro,0) 
      else 0 
       end 
     else 0  
      end  
     else 0 
     end )as totaldctohonorarios, 
     sum 
     (case linefact.tipo 
     when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(totaldctoeuro,0) 
      else 0 
      end  
     else 0 
    end )as totaldctoarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totaldctoeuro,0) 
     else 0  
      end  
     else 0  
     end )as totaldctogastos, 
    sum  
        (case linefact.tipo  
        when 'ANTICIPO' then  
        isnull(salidaeuro,0) 
        else 0 
        end  )as totalsalidaanticipos, 
       sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
    case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0)  
        when 0 then 
        isnull(salidaeuro,0) 
      else 0  
        end 
     else 0 
      end  
     else 0  
     end )as totalsalidahonorarios, 
     sum 
     (case linefact.tipo 
    when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(salidaeuro,0) 
      else 0  
      end 
     else 0  
    end )as totalsalidaarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0)  
     when 1 then 
      isnull(salidaeuro,0)  
     else 0 
      end 
     else 0  
     end )as totalsalidagastos,                                                 
linefact.inumfactura as linefactinumfactura, linefact.yearfact as linefactyearfact, linefact.serie as linefactserie, linefact.codsubusu as linefactcodsubusu from linefact
left join cuencli c on c.icodcli=linefact.inumexpexho and c.dfecha =linefact.fechaconcep and c.linea  = linefact.lineacuentas
where (linefact.tipo = 'HONORARIO' or linefact.tipo = 'ANTICIPO')
group by linefact.inumfactura, linefact.yearfact,  linefact.serie, linefact.codsubusu)
as tbliva on tbliva.linefactinumfactura=facturas.inumfactura and tbliva.linefactyearfact=facturas.yearfact and tbliva.linefactcodsubusu=facturas.codsubusu and tbliva.linefactserie=facturas.serie
where facturas.inumfactura = @inumfactura and facturas.yearfact = @yearfact and facturas.codsubusu = @codsubusu and facturas.serie like @serie ",sourcedatosfact
346,45,qrylinefact,"select (linefact.descripcion + ' ' + isnull(cast(linefact.notas as varchar(MAX)),' ')) as descripnotas, (isnull(entradaeuro,0)+isnull(salidaeuro,0)) as importe,(isnull(salidaeuro,0)-isnull(totaldctoeuro,0)) as salidamenosdcto, linefact.descripcion,linefact.salidaeuro, s.nombre as usuario,
(round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0)) -
round((round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0))*(isnull(linefact.dctolinea2,0)/100),2) as honocondcto1dcto2,
art.referencia as referenciaart,linefact.origen,c.idartstock,c.honogasto,
(case linefact.tipoproformarel
 when 0 then 'Oficial'
 when 1 then 'Pro forma'
 when 2 then 'Presupuesto'
 when 3 then 'Albarán'
 when 4 then 'Pedido'
 When 5 then 'Orden'
 else ''
 end) as TipoDoc
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.porrecargo)/100) as cuotarec
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.poriva)/100) as cuotaivasinrec
,art.campo1,art.campo2,art.campo3,art.campo4,art.campo5,art.campo6,art.campo7,art.campo8
,art.campofecha1,art.campofecha2,art.campofecha3,art.campofecha4,art.notas as notasArt,
case when linefact.unidades=0 then linefact.fpreciounitario
else cast(round(isnull(linefact.fpreciounitario,0)-(isnull(linefact.totaldctoeuro,0)/isnull(linefact.unidades,1)),2) as money) end as preciounimenosdcto,
c.numexpediente  , case (isnull(cm.snombrecli, ''))
when '' then
	case (isnull(cliseg.snombrecli, ''))
	when '' then clisegclider.snombrecli
	else cliseg.snombrecli
	end
else cm.snombrecli
end
as pacientenombre from linefact
left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea 
left join subusu s on c.subusu=s.icodsubusu 
left join articulos art on c.idartstock=art.id left join controlmutua cm on linefact.linea = cm.linefact and linefact.inumfactura = cm.inumfactura and linefact.yearfact = cm.yearfact and linefact.codsubusu=cm.codsubusu and linefact.serie=cm.serie 
and linefact.fechaconcep=cm.dfechaconceptofact
left join segcli_cuencli segcuen on linefact.Origen = 'cli' and segcuen.icodcli_cuencli=linefact.inumexpexho and segcuen.linea_cuencli=linefact.lineacuentas and segcuen.dfecha_cuencli=linefact.fechaconcep
left join clientes cliseg on cliseg.icodcli=segcuen.icodcli_segcli
left join cuenclisegclider on linefact.origen = 'cli' and cuenclisegclider.icodclicuencli=linefact.inumexpexho and cuenclisegclider.dfechacuencli=linefact.fechaconcep and cuenclisegclider.lineacuencli=linefact.lineacuentas
left join segclider on segclider.id=cuenclisegclider.idsegclider and segclider.icodcli<>linefact.inumexpexho
left join clientes clisegclider on clisegclider.icodcli=segclider.icodcli  where linefact.inumfactura = @inumfactura and linefact.yearfact = @yearfact and linefact.codsubusu = @codsubusu and linefact.serie = @serie order by linefact.numero",sourcedatosfact
347,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
347,32,qryfact,"select ((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalbaseivairpf,((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro) as totalbaseiva,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0) + facturas.totalivaeuro) as totalhonodctoiva,
(isnull(facturas.totalderechoseuro,0) - isnull(facturas.totanticipos,0)) as totderechomenosanticipo,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) as totalbaseimp,
(facturas.totalsuplidoseuro + (facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalminuta, facturas.nombrecli,facturas.nifcli,facturas.domiciliocli,facturas.codpostalcli,facturas.provinciacli,facturas.inumfactura,facturas.serie,facturas.fecha,facturas.totaldctoeuro,facturas.totalivaeuro,facturas.totalirpfeuro,facturas.totaleuro,(substring(facturas.cuentabanco,1,4) + '************' + substring(facturas.cuentabanco,17,4)) as cuentabancocifr,
(substring(facturas.iban,1,8) + replicate('*',LEN(facturas.iban)-8)) as ibancifr,(datename(day,facturas.fecha) + ' de ' + datename(month, facturas.fecha) + ' de ' + datename(year,facturas.fecha)) as fechafacturalarga,
(f2.totalderechoseuro - isnull(f2.totaldctoeuro,0)) as totalbaseimpAbo,f2.TotalIvaEuro as totalivaAbo,f2.TotalEuro as totaleuroabo,
(((isnull(facturas.honocondctolin,0) - isnull(facturas.totsolodctofact,0)) + isnull(facturas.totportes,0))) as baseConPortes,pl.descripcion as descplazo,
(select sum(isnull(salidaeuro,0)) - sum(isnull(totaldctoeuro,0)) FROM linefact
	left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea
	where (tipo = 'HONORARIO') AND (ISNULL(honogasto,0) = 0) and (ISNULL(bhonoarticulo,0) = 0) and (ISNULL(bhonodcto,0) = 0)
	and facturas.inumfactura = linefact.inumfactura and facturas.yearfact=linefact.yearfact and facturas.codsubusu=linefact.codsubusu and facturas.serie=linefact.serie) as totbaseimpsolohono,
(isnull(facturas.TotalEuro,0)) as totalletra, totalivaanticipos,totalivahonorarios,totalivaarticulos
 ,totalivagastos, totaldctoanticipos, totaldctohonorarios, totaldctoarticulos, totaldctogastos, 
totalsalidaanticipos, totalsalidahonorarios, totalsalidaarticulos, totalsalidagastos, 
(totalsalidaanticipos - totaldctoanticipos + totalivaanticipos) as totmenosdctomasivaanticipos, 
(totalsalidahonorarios - totaldctohonorarios + totalivahonorarios) as totmenosdctomasivahonorarios, 
(totalsalidaarticulos - totaldctoarticulos + totalivaarticulos) as totmenosdctomasivaarticulos, 
(totalsalidagastos - totaldctogastos + totalivagastos) as totmenosdctomasivagastos, identificadorTBAI
from facturas
left join facturas f2 on facturas.yearfactabonada=f2.yearfact and facturas.inumfactabonada=f2.inumfactura and facturas.serieabonada=f2.serie
left join facturasTicketBai ft on facturas.yearfact = ft.yearfact and facturas.inumfactura = ft.inumfactura and facturas.codsubusu = ft.codsubusu and facturas.serie = ft.serie
left join plazosc pl on pl.id = facturas.idplazos
left join
(select
	sum
	(
	case linefact.tipo
	when 'ANTICIPO' then
	isnull(totalivaeuro,0)
	else 0
	end) as totalivaanticipos,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.honogasto,0)
		when 0 then
			case ISNULL(c.bhonoarticulo,0)
			when 0 then
			isnull(totalivaeuro,0)
			else 0
			end
		else 0
		end
	else 0
	end) as totalivahonorarios,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.bhonoarticulo,0)
		when 1 then
		isnull(totalivaeuro,0)
		else 0
		end
	else 0
	end) as totalivaarticulos,
    sum  
    (   
     case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totalivaeuro,0) 
     else 0  
      end  
     else 0  
     end )as totalivagastos, 
     sum  
     (  
     case linefact.tipo 
     when 'ANTICIPO' then 
     isnull(totaldctoeuro,0) 
     else 0  
     end  )as totaldctoanticipos, 
     sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
     case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0) 
        when 0 then  
        isnull(totaldctoeuro,0) 
      else 0 
       end 
     else 0  
      end  
     else 0 
     end )as totaldctohonorarios, 
     sum 
     (case linefact.tipo 
     when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(totaldctoeuro,0) 
      else 0 
      end  
     else 0 
    end )as totaldctoarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totaldctoeuro,0) 
     else 0  
      end  
     else 0  
     end )as totaldctogastos, 
    sum  
        (case linefact.tipo  
        when 'ANTICIPO' then  
        isnull(salidaeuro,0) 
        else 0 
        end  )as totalsalidaanticipos, 
       sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
    case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0)  
        when 0 then 
        isnull(salidaeuro,0) 
      else 0  
        end 
     else 0 
      end  
     else 0  
     end )as totalsalidahonorarios, 
     sum 
     (case linefact.tipo 
    when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(salidaeuro,0) 
      else 0  
      end 
     else 0  
    end )as totalsalidaarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0)  
     when 1 then 
      isnull(salidaeuro,0)  
     else 0 
      end 
     else 0  
     end )as totalsalidagastos,                                                 
linefact.inumfactura as linefactinumfactura, linefact.yearfact as linefactyearfact, linefact.serie as linefactserie, linefact.codsubusu as linefactcodsubusu from linefact
left join cuencli c on c.icodcli=linefact.inumexpexho and c.dfecha =linefact.fechaconcep and c.linea  = linefact.lineacuentas
where (linefact.tipo = 'HONORARIO' or linefact.tipo = 'ANTICIPO')
group by linefact.inumfactura, linefact.yearfact,  linefact.serie, linefact.codsubusu)
as tbliva on tbliva.linefactinumfactura=facturas.inumfactura and tbliva.linefactyearfact=facturas.yearfact and tbliva.linefactcodsubusu=facturas.codsubusu and tbliva.linefactserie=facturas.serie
where facturas.inumfactura = @inumfactura and facturas.yearfact = @yearfact and facturas.codsubusu = @codsubusu and facturas.serie like @serie ",sourcedatosfact
347,45,qrylinefact,"select (linefact.descripcion + ' ' + isnull(cast(linefact.notas as varchar(MAX)),' ')) as descripnotas, (isnull(entradaeuro,0)+isnull(salidaeuro,0)) as importe,(isnull(salidaeuro,0)-isnull(totaldctoeuro,0)) as salidamenosdcto, linefact.descripcion,linefact.salidaeuro, s.nombre as usuario,
(round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0)) -
round((round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0))*(isnull(linefact.dctolinea2,0)/100),2) as honocondcto1dcto2,
art.referencia as referenciaart,linefact.origen,c.idartstock,c.honogasto,
(case linefact.tipoproformarel
 when 0 then 'Oficial'
 when 1 then 'Pro forma'
 when 2 then 'Presupuesto'
 when 3 then 'Albarán'
 when 4 then 'Pedido'
 When 5 then 'Orden'
 else ''
 end) as TipoDoc
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.porrecargo)/100) as cuotarec
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.poriva)/100) as cuotaivasinrec
,art.campo1,art.campo2,art.campo3,art.campo4,art.campo5,art.campo6,art.campo7,art.campo8
,art.campofecha1,art.campofecha2,art.campofecha3,art.campofecha4,art.notas as notasArt,
case when linefact.unidades=0 then linefact.fpreciounitario
else cast(round(isnull(linefact.fpreciounitario,0)-(isnull(linefact.totaldctoeuro,0)/isnull(linefact.unidades,1)),2) as money) end as preciounimenosdcto,
c.numexpediente  , case (isnull(cm.snombrecli, ''))
when '' then
	case (isnull(cliseg.snombrecli, ''))
	when '' then clisegclider.snombrecli
	else cliseg.snombrecli
	end
else cm.snombrecli
end
as pacientenombre from linefact
left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea 
left join subusu s on c.subusu=s.icodsubusu 
left join articulos art on c.idartstock=art.id left join controlmutua cm on linefact.linea = cm.linefact and linefact.inumfactura = cm.inumfactura and linefact.yearfact = cm.yearfact and linefact.codsubusu=cm.codsubusu and linefact.serie=cm.serie 
and linefact.fechaconcep=cm.dfechaconceptofact
left join segcli_cuencli segcuen on linefact.Origen = 'cli' and segcuen.icodcli_cuencli=linefact.inumexpexho and segcuen.linea_cuencli=linefact.lineacuentas and segcuen.dfecha_cuencli=linefact.fechaconcep
left join clientes cliseg on cliseg.icodcli=segcuen.icodcli_segcli
left join cuenclisegclider on linefact.origen = 'cli' and cuenclisegclider.icodclicuencli=linefact.inumexpexho and cuenclisegclider.dfechacuencli=linefact.fechaconcep and cuenclisegclider.lineacuencli=linefact.lineacuentas
left join segclider on segclider.id=cuenclisegclider.idsegclider and segclider.icodcli<>linefact.inumexpexho
left join clientes clisegclider on clisegclider.icodcli=segclider.icodcli  where linefact.inumfactura = @inumfactura and linefact.yearfact = @yearfact and linefact.codsubusu = @codsubusu and linefact.serie = @serie order by linefact.numero",sourcedatosfact
348,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
348,32,qryfact,"select ((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalbaseivairpf,((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro) as totalbaseiva,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0) + facturas.totalivaeuro) as totalhonodctoiva,
(isnull(facturas.totalderechoseuro,0) - isnull(facturas.totanticipos,0)) as totderechomenosanticipo,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) as totalbaseimp,
(facturas.totalsuplidoseuro + (facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalminuta, facturas.nombrecli,facturas.nifcli,facturas.domiciliocli,facturas.poblacioncli,facturas.codpostalcli,facturas.provinciacli,facturas.inumfactura,facturas.serie,facturas.fecha,facturas.totaldctoeuro,facturas.totaleuro,(substring(facturas.cuentabanco,1,4) + '************' + substring(facturas.cuentabanco,17,4)) as cuentabancocifr,
(substring(facturas.iban,1,8) + replicate('*',LEN(facturas.iban)-8)) as ibancifr,(datename(day,facturas.fecha) + ' de ' + datename(month, facturas.fecha) + ' de ' + datename(year,facturas.fecha)) as fechafacturalarga,
(f2.totalderechoseuro - isnull(f2.totaldctoeuro,0)) as totalbaseimpAbo,f2.TotalIvaEuro as totalivaAbo,f2.TotalEuro as totaleuroabo,
(((isnull(facturas.honocondctolin,0) - isnull(facturas.totsolodctofact,0)) + isnull(facturas.totportes,0))) as baseConPortes,pl.descripcion as descplazo,
(select sum(isnull(salidaeuro,0)) - sum(isnull(totaldctoeuro,0)) FROM linefact
	left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea
	where (tipo = 'HONORARIO') AND (ISNULL(honogasto,0) = 0) and (ISNULL(bhonoarticulo,0) = 0) and (ISNULL(bhonodcto,0) = 0)
	and facturas.inumfactura = linefact.inumfactura and facturas.yearfact=linefact.yearfact and facturas.codsubusu=linefact.codsubusu and facturas.serie=linefact.serie) as totbaseimpsolohono,
(isnull(facturas.TotalEuro,0)) as totalletra, totalivaanticipos,totalivahonorarios,totalivaarticulos
 ,totalivagastos, totaldctoanticipos, totaldctohonorarios, totaldctoarticulos, totaldctogastos, 
totalsalidaanticipos, totalsalidahonorarios, totalsalidaarticulos, totalsalidagastos, 
(totalsalidaanticipos - totaldctoanticipos + totalivaanticipos) as totmenosdctomasivaanticipos, 
(totalsalidahonorarios - totaldctohonorarios + totalivahonorarios) as totmenosdctomasivahonorarios, 
(totalsalidaarticulos - totaldctoarticulos + totalivaarticulos) as totmenosdctomasivaarticulos, 
(totalsalidagastos - totaldctogastos + totalivagastos) as totmenosdctomasivagastos, identificadorTBAI
from facturas
left join facturas f2 on facturas.yearfactabonada=f2.yearfact and facturas.inumfactabonada=f2.inumfactura and facturas.serieabonada=f2.serie
left join facturasTicketBai ft on facturas.yearfact = ft.yearfact and facturas.inumfactura = ft.inumfactura and facturas.codsubusu = ft.codsubusu and facturas.serie = ft.serie
left join plazosc pl on pl.id = facturas.idplazos
left join
(select
	sum
	(
	case linefact.tipo
	when 'ANTICIPO' then
	isnull(totalivaeuro,0)
	else 0
	end) as totalivaanticipos,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.honogasto,0)
		when 0 then
			case ISNULL(c.bhonoarticulo,0)
			when 0 then
			isnull(totalivaeuro,0)
			else 0
			end
		else 0
		end
	else 0
	end) as totalivahonorarios,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.bhonoarticulo,0)
		when 1 then
		isnull(totalivaeuro,0)
		else 0
		end
	else 0
	end) as totalivaarticulos,
    sum  
    (   
     case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totalivaeuro,0) 
     else 0  
      end  
     else 0  
     end )as totalivagastos, 
     sum  
     (  
     case linefact.tipo 
     when 'ANTICIPO' then 
     isnull(totaldctoeuro,0) 
     else 0  
     end  )as totaldctoanticipos, 
     sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
     case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0) 
        when 0 then  
        isnull(totaldctoeuro,0) 
      else 0 
       end 
     else 0  
      end  
     else 0 
     end )as totaldctohonorarios, 
     sum 
     (case linefact.tipo 
     when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(totaldctoeuro,0) 
      else 0 
      end  
     else 0 
    end )as totaldctoarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totaldctoeuro,0) 
     else 0  
      end  
     else 0  
     end )as totaldctogastos, 
    sum  
        (case linefact.tipo  
        when 'ANTICIPO' then  
        isnull(salidaeuro,0) 
        else 0 
        end  )as totalsalidaanticipos, 
       sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
    case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0)  
        when 0 then 
        isnull(salidaeuro,0) 
      else 0  
        end 
     else 0 
      end  
     else 0  
     end )as totalsalidahonorarios, 
     sum 
     (case linefact.tipo 
    when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(salidaeuro,0) 
      else 0  
      end 
     else 0  
    end )as totalsalidaarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0)  
     when 1 then 
      isnull(salidaeuro,0)  
     else 0 
      end 
     else 0  
     end )as totalsalidagastos,                                                 
linefact.inumfactura as linefactinumfactura, linefact.yearfact as linefactyearfact, linefact.serie as linefactserie, linefact.codsubusu as linefactcodsubusu from linefact
left join cuencli c on c.icodcli=linefact.inumexpexho and c.dfecha =linefact.fechaconcep and c.linea  = linefact.lineacuentas
where (linefact.tipo = 'HONORARIO' or linefact.tipo = 'ANTICIPO')
group by linefact.inumfactura, linefact.yearfact,  linefact.serie, linefact.codsubusu)
as tbliva on tbliva.linefactinumfactura=facturas.inumfactura and tbliva.linefactyearfact=facturas.yearfact and tbliva.linefactcodsubusu=facturas.codsubusu and tbliva.linefactserie=facturas.serie
where facturas.inumfactura = @inumfactura and facturas.yearfact = @yearfact and facturas.codsubusu = @codsubusu and facturas.serie like @serie ",sourcedatosfact
348,45,qrylinefact,"select (linefact.descripcion + ' ' + isnull(cast(linefact.notas as varchar(MAX)),' ')) as descripnotas, (isnull(entradaeuro,0)+isnull(salidaeuro,0)) as importe,(isnull(salidaeuro,0)-isnull(totaldctoeuro,0)) as salidamenosdcto, null,linefact.salidaeuro, s.nombre as usuario,
(round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0)) -
round((round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0))*(isnull(linefact.dctolinea2,0)/100),2) as honocondcto1dcto2,
art.referencia as referenciaart,linefact.origen,c.idartstock,c.honogasto,
(case linefact.tipoproformarel
 when 0 then 'Oficial'
 when 1 then 'Pro forma'
 when 2 then 'Presupuesto'
 when 3 then 'Albarán'
 when 4 then 'Pedido'
 When 5 then 'Orden'
 else ''
 end) as TipoDoc
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.porrecargo)/100) as cuotarec
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.poriva)/100) as cuotaivasinrec
,art.campo1,art.campo2,art.campo3,art.campo4,art.campo5,art.campo6,art.campo7,art.campo8
,art.campofecha1,art.campofecha2,art.campofecha3,art.campofecha4,art.notas as notasArt,
case when linefact.unidades=0 then linefact.fpreciounitario
else cast(round(isnull(linefact.fpreciounitario,0)-(isnull(linefact.totaldctoeuro,0)/isnull(linefact.unidades,1)),2) as money) end as preciounimenosdcto,
c.numexpediente  , case (isnull(cm.snombrecli, ''))
when '' then
	case (isnull(cliseg.snombrecli, ''))
	when '' then clisegclider.snombrecli
	else cliseg.snombrecli
	end
else cm.snombrecli
end
as pacientenombre from linefact
left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea 
left join subusu s on c.subusu=s.icodsubusu 
left join articulos art on c.idartstock=art.id left join controlmutua cm on linefact.linea = cm.linefact and linefact.inumfactura = cm.inumfactura and linefact.yearfact = cm.yearfact and linefact.codsubusu=cm.codsubusu and linefact.serie=cm.serie 
and linefact.fechaconcep=cm.dfechaconceptofact
left join segcli_cuencli segcuen on linefact.Origen = 'cli' and segcuen.icodcli_cuencli=linefact.inumexpexho and segcuen.linea_cuencli=linefact.lineacuentas and segcuen.dfecha_cuencli=linefact.fechaconcep
left join clientes cliseg on cliseg.icodcli=segcuen.icodcli_segcli
left join cuenclisegclider on linefact.origen = 'cli' and cuenclisegclider.icodclicuencli=linefact.inumexpexho and cuenclisegclider.dfechacuencli=linefact.fechaconcep and cuenclisegclider.lineacuencli=linefact.lineacuentas
left join segclider on segclider.id=cuenclisegclider.idsegclider and segclider.icodcli<>linefact.inumexpexho
left join clientes clisegclider on clisegclider.icodcli=segclider.icodcli  where linefact.inumfactura = @inumfactura and linefact.yearfact = @yearfact and linefact.codsubusu = @codsubusu and linefact.serie = @serie order by linefact.numero",sourcedatosfact
349,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
349,32,qryfact,"select ((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalbaseivairpf,((facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro) as totalbaseiva,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0) + facturas.totalivaeuro) as totalhonodctoiva,
(isnull(facturas.totalderechoseuro,0) - isnull(facturas.totanticipos,0)) as totderechomenosanticipo,
(facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) as totalbaseimp,
(facturas.totalsuplidoseuro + (facturas.totalderechoseuro - isnull(facturas.totaldctoeuro,0)) + facturas.totalivaeuro - facturas.totalirpfeuro) as totalminuta, facturas.nombrecli,facturas.nifcli,facturas.domiciliocli,facturas.poblacioncli,facturas.codpostalcli,facturas.provinciacli,facturas.inumfactura,facturas.serie,facturas.fecha,facturas.totaldctoeuro,facturas.iva,facturas.totalivaeuro,facturas.totaleuro,(substring(facturas.cuentabanco,1,4) + '************' + substring(facturas.cuentabanco,17,4)) as cuentabancocifr,
(substring(facturas.iban,1,8) + replicate('*',LEN(facturas.iban)-8)) as ibancifr,(datename(day,facturas.fecha) + ' de ' + datename(month, facturas.fecha) + ' de ' + datename(year,facturas.fecha)) as fechafacturalarga,
(f2.totalderechoseuro - isnull(f2.totaldctoeuro,0)) as totalbaseimpAbo,f2.TotalIvaEuro as totalivaAbo,f2.TotalEuro as totaleuroabo,
(((isnull(facturas.honocondctolin,0) - isnull(facturas.totsolodctofact,0)) + isnull(facturas.totportes,0))) as baseConPortes,pl.descripcion as descplazo,
(select sum(isnull(salidaeuro,0)) - sum(isnull(totaldctoeuro,0)) FROM linefact
	left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea
	where (tipo = 'HONORARIO') AND (ISNULL(honogasto,0) = 0) and (ISNULL(bhonoarticulo,0) = 0) and (ISNULL(bhonodcto,0) = 0)
	and facturas.inumfactura = linefact.inumfactura and facturas.yearfact=linefact.yearfact and facturas.codsubusu=linefact.codsubusu and facturas.serie=linefact.serie) as totbaseimpsolohono,
(isnull(facturas.TotalEuro,0)) as totalletra, totalivaanticipos,totalivahonorarios,totalivaarticulos
 ,totalivagastos, totaldctoanticipos, totaldctohonorarios, totaldctoarticulos, totaldctogastos, 
totalsalidaanticipos, totalsalidahonorarios, totalsalidaarticulos, totalsalidagastos, 
(totalsalidaanticipos - totaldctoanticipos + totalivaanticipos) as totmenosdctomasivaanticipos, 
(totalsalidahonorarios - totaldctohonorarios + totalivahonorarios) as totmenosdctomasivahonorarios, 
(totalsalidaarticulos - totaldctoarticulos + totalivaarticulos) as totmenosdctomasivaarticulos, 
(totalsalidagastos - totaldctogastos + totalivagastos) as totmenosdctomasivagastos, identificadorTBAI
from facturas
left join facturas f2 on facturas.yearfactabonada=f2.yearfact and facturas.inumfactabonada=f2.inumfactura and facturas.serieabonada=f2.serie
left join facturasTicketBai ft on facturas.yearfact = ft.yearfact and facturas.inumfactura = ft.inumfactura and facturas.codsubusu = ft.codsubusu and facturas.serie = ft.serie
left join plazosc pl on pl.id = facturas.idplazos
left join
(select
	sum
	(
	case linefact.tipo
	when 'ANTICIPO' then
	isnull(totalivaeuro,0)
	else 0
	end) as totalivaanticipos,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.honogasto,0)
		when 0 then
			case ISNULL(c.bhonoarticulo,0)
			when 0 then
			isnull(totalivaeuro,0)
			else 0
			end
		else 0
		end
	else 0
	end) as totalivahonorarios,
	sum
	(
	case linefact.tipo
	when 'HONORARIO' then
		case ISNULL(c.bhonoarticulo,0)
		when 1 then
		isnull(totalivaeuro,0)
		else 0
		end
	else 0
	end) as totalivaarticulos,
    sum  
    (   
     case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totalivaeuro,0) 
     else 0  
      end  
     else 0  
     end )as totalivagastos, 
     sum  
     (  
     case linefact.tipo 
     when 'ANTICIPO' then 
     isnull(totaldctoeuro,0) 
     else 0  
     end  )as totaldctoanticipos, 
     sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
     case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0) 
        when 0 then  
        isnull(totaldctoeuro,0) 
      else 0 
       end 
     else 0  
      end  
     else 0 
     end )as totaldctohonorarios, 
     sum 
     (case linefact.tipo 
     when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(totaldctoeuro,0) 
      else 0 
      end  
     else 0 
    end )as totaldctoarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0) 
     when 1 then  
      isnull(totaldctoeuro,0) 
     else 0  
      end  
     else 0  
     end )as totaldctogastos, 
    sum  
        (case linefact.tipo  
        when 'ANTICIPO' then  
        isnull(salidaeuro,0) 
        else 0 
        end  )as totalsalidaanticipos, 
       sum 
    ( case linefact.tipo 
     when 'HONORARIO' then  
    case ISNULL(c.honogasto,0) 
     when 0 then   
       case ISNULL(c.bhonoarticulo,0)  
        when 0 then 
        isnull(salidaeuro,0) 
      else 0  
        end 
     else 0 
      end  
     else 0  
     end )as totalsalidahonorarios, 
     sum 
     (case linefact.tipo 
    when 'HONORARIO' then 
      case ISNULL(c.bhonoarticulo,0) 
     when 1 then 
      isnull(salidaeuro,0) 
      else 0  
      end 
     else 0  
    end )as totalsalidaarticulos, 
    sum 
    (case linefact.tipo 
     when 'HONORARIO' then 
     case ISNULL(c.honogasto,0)  
     when 1 then 
      isnull(salidaeuro,0)  
     else 0 
      end 
     else 0  
     end )as totalsalidagastos,                                                 
linefact.inumfactura as linefactinumfactura, linefact.yearfact as linefactyearfact, linefact.serie as linefactserie, linefact.codsubusu as linefactcodsubusu from linefact
left join cuencli c on c.icodcli=linefact.inumexpexho and c.dfecha =linefact.fechaconcep and c.linea  = linefact.lineacuentas
where (linefact.tipo = 'HONORARIO' or linefact.tipo = 'ANTICIPO')
group by linefact.inumfactura, linefact.yearfact,  linefact.serie, linefact.codsubusu)
as tbliva on tbliva.linefactinumfactura=facturas.inumfactura and tbliva.linefactyearfact=facturas.yearfact and tbliva.linefactcodsubusu=facturas.codsubusu and tbliva.linefactserie=facturas.serie
where facturas.inumfactura = @inumfactura and facturas.yearfact = @yearfact and facturas.codsubusu = @codsubusu and facturas.serie like @serie ",sourcedatosfact
349,45,qrylinefact,"select (linefact.descripcion + ' ' + isnull(cast(linefact.notas as varchar(MAX)),' ')) as descripnotas, (isnull(entradaeuro,0)+isnull(salidaeuro,0)) as importe,(isnull(salidaeuro,0)-isnull(totaldctoeuro,0)) as salidamenosdcto, linefact.unidades,linefact.descripcion,linefact.fpreciounitario,linefact.dctolinea,linefact.iva,linefact.totaleuro, s.nombre as usuario,
(round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0)) -
round((round((isnull(linefact.salidaeuro,0) - round(isnull(linefact.salidaeuro,0)*(isnull(linefact.dctolinea,0)/100),2)),0))*(isnull(linefact.dctolinea2,0)/100),2) as honocondcto1dcto2,
art.referencia as referenciaart,linefact.origen,c.idartstock,c.honogasto,
(case linefact.tipoproformarel
 when 0 then 'Oficial'
 when 1 then 'Pro forma'
 when 2 then 'Presupuesto'
 when 3 then 'Albarán'
 when 4 then 'Pedido'
 When 5 then 'Orden'
 else ''
 end) as TipoDoc
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.porrecargo)/100) as cuotarec
,((((isnull(linefact.salidaeuro,0))-(isnull(linefact.totaldctoeuro,0)))*linefact.poriva)/100) as cuotaivasinrec
,art.campo1,art.campo2,art.campo3,art.campo4,art.campo5,art.campo6,art.campo7,art.campo8
,art.campofecha1,art.campofecha2,art.campofecha3,art.campofecha4,art.notas as notasArt,
case when linefact.unidades=0 then linefact.fpreciounitario
else cast(round(isnull(linefact.fpreciounitario,0)-(isnull(linefact.totaldctoeuro,0)/isnull(linefact.unidades,1)),2) as money) end as preciounimenosdcto,
c.numexpediente  , case (isnull(cm.snombrecli, ''))
when '' then
	case (isnull(cliseg.snombrecli, ''))
	when '' then clisegclider.snombrecli
	else cliseg.snombrecli
	end
else cm.snombrecli
end
as pacientenombre from linefact
left join cuencli c on linefact.inumexpexho=c.icodcli and linefact.fechaconcep=c.dfecha and linefact.lineacuentas=c.linea 
left join subusu s on c.subusu=s.icodsubusu 
left join articulos art on c.idartstock=art.id left join controlmutua cm on linefact.linea = cm.linefact and linefact.inumfactura = cm.inumfactura and linefact.yearfact = cm.yearfact and linefact.codsubusu=cm.codsubusu and linefact.serie=cm.serie 
and linefact.fechaconcep=cm.dfechaconceptofact
left join segcli_cuencli segcuen on linefact.Origen = 'cli' and segcuen.icodcli_cuencli=linefact.inumexpexho and segcuen.linea_cuencli=linefact.lineacuentas and segcuen.dfecha_cuencli=linefact.fechaconcep
left join clientes cliseg on cliseg.icodcli=segcuen.icodcli_segcli
left join cuenclisegclider on linefact.origen = 'cli' and cuenclisegclider.icodclicuencli=linefact.inumexpexho and cuenclisegclider.dfechacuencli=linefact.fechaconcep and cuenclisegclider.lineacuencli=linefact.lineacuentas
left join segclider on segclider.id=cuenclisegclider.idsegclider and segclider.icodcli<>linefact.inumexpexho
left join clientes clisegclider on clisegclider.icodcli=segclider.icodcli  where linefact.inumfactura = @inumfactura and linefact.yearfact = @yearfact and linefact.codsubusu = @codsubusu and linefact.serie = @serie order by linefact.numero",sourcedatosfact
350,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
350,4,qrycli,"select clientes.snombrecli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
350,78,qryprevcobros,"SELECT prevcobros.fechaingreso as fechagasing,prevcobros.nombrecli as cliente,
prevcobros.cobrado as realizada,prevcobros.fechacobro as fecharealizada,
prevcobros.inumfactura as inumfact,prevcobros.ctacliente as ctaacrcli,
prevcobros.ctaingreso as ctagasing, 1 as tipo,
(case prevcobros.factura when 1 then 'Factura Oficial' when 2 then
(case prevcobros.tipoprof when 2 then 'Presupuesto' when 3 then 'Albarán'
else 'Factura Proforma' end)
else '' end) as tipofactura,
l.fecha as fecharemesa,
(case isnull(l.fecha, '') when '' then 0 else 1 end) as estaremesado,
r.banco as banco,
(case prevcobros.factura when 1 then f.fecha when 2 then prof.fecha end) as fechafact,
f.tipologia1 as tip1,f.tipologia2 as tip2,f.tipologia3 as tip3,
cli.fechaalta as fechaaltacliente, null,prevcobros.concepto,prevcobros.total,centrospredef.sdescripcion,prevcobros.total as totalletra ,s.nombre as usuario, cp2.sdescripcion as sdescripcioncentrospredef ,vistapac.pacientenombre  FROM prevcobros
left join linereme l on l.idprevcobros=prevcobros.id
left join remesas r on l.idremesa=r.idremesa
left join facturas f on f.yearfact=prevcobros.yearfact and f.inumfactura=prevcobros.inumfactura and
f.codsubusu=prevcobros.subusufact and f.serie=prevcobros.serie
left join proforma prof on prof.yearfact=prevcobros.yearfact and prof.inumfactura=prevcobros.inumfactura and
prof.codsubusu=prevcobros.subusufact and prof.tipoprof=prevcobros.tipoprof
left join clientes cli on prevcobros.inumexp=cli.icodcli and prevcobros.origen = 'cli'
left join centrospredef on centrospredef.id=cli.idcentros
left join centrospredef cp2 on cp2.id=prevcobros.idcentros
left join subusu s on prevcobros.codsubusu=s.icodsubusu left join vListadoCobrosPacientes vistapac on vistapac.id=prevcobros.id  where prevcobros.id = @id ",sourcedatosfact
351,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
351,4,qrycli,"select clientes.snombrecli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
351,78,qryprevcobros,"SELECT prevcobros.fechaingreso as fechagasing,prevcobros.nombrecli as cliente,
prevcobros.cobrado as realizada,prevcobros.fechacobro as fecharealizada,
prevcobros.inumfactura as inumfact,prevcobros.ctacliente as ctaacrcli,
prevcobros.ctaingreso as ctagasing, 1 as tipo,
(case prevcobros.factura when 1 then 'Factura Oficial' when 2 then
(case prevcobros.tipoprof when 2 then 'Presupuesto' when 3 then 'Albarán'
else 'Factura Proforma' end)
else '' end) as tipofactura,
l.fecha as fecharemesa,
(case isnull(l.fecha, '') when '' then 0 else 1 end) as estaremesado,
r.banco as banco,
(case prevcobros.factura when 1 then f.fecha when 2 then prof.fecha end) as fechafact,
f.tipologia1 as tip1,f.tipologia2 as tip2,f.tipologia3 as tip3,
cli.fechaalta as fechaaltacliente, null,prevcobros.concepto,prevcobros.total,centrospredef.sdescripcion,prevcobros.total as totalletra ,s.nombre as usuario, cp2.sdescripcion as sdescripcioncentrospredef ,vistapac.pacientenombre  FROM prevcobros
left join linereme l on l.idprevcobros=prevcobros.id
left join remesas r on l.idremesa=r.idremesa
left join facturas f on f.yearfact=prevcobros.yearfact and f.inumfactura=prevcobros.inumfactura and
f.codsubusu=prevcobros.subusufact and f.serie=prevcobros.serie
left join proforma prof on prof.yearfact=prevcobros.yearfact and prof.inumfactura=prevcobros.inumfactura and
prof.codsubusu=prevcobros.subusufact and prof.tipoprof=prevcobros.tipoprof
left join clientes cli on prevcobros.inumexp=cli.icodcli and prevcobros.origen = 'cli'
left join centrospredef on centrospredef.id=cli.idcentros
left join centrospredef cp2 on cp2.id=prevcobros.idcentros
left join subusu s on prevcobros.codsubusu=s.icodsubusu left join vListadoCobrosPacientes vistapac on vistapac.id=prevcobros.id  where prevcobros.id = @id ",sourcedatosfact
352,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
352,4,qrycli,"select clientes.nmandato,clientes.snombrecli,clientes.sdomiciliocli,clientes.scodpostalcli,clientes.spoblacioncli,clientes.snombrepais,clientes.iban,clientes.bicswift, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
353,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
353,4,qrycli,"select clientes.codigo,clientes.snombrecli,clientes.edad,clientes.sdomiciliocli,clientes.spoblacioncli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
353,35,qryseg,"select null, segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero,
CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo, isnull(coleg.numcolegiado,'') as numcolegusuact  , ecita.descripcion as estadosalaespera  from segcli left join subusu on segcli.subusu=subusu.icodsubusu
left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1
left join clientes on st.icodtercero=clientes.icodcli
left join vlistadobonos on vlistadobonos.id = segcli.idbono
left join clientes coleg on segcli.subusu =coleg.codsubusu and coleg.tipobd=1  left join estadosCita ecita on ecita.id=segcli.idEstadoCita where segcli.icodcli = @icodcli and tipoactu <> 'Aviso' order by segcli.dfechaact,segcli.horainiact",
353,81,qryhistoriaclinica,select 'Historia Clínica',
354,4,qryclientes,"SELECT clientes.snombrecli,clientes.snifcli FROM clientes WHERE icodcli = @icodcli",
354,37,qrysubusu,SELECT subusu.nombre FROM subusu WHERE icodsubusu = @icodsubusu,
354,70,qryrecetasmedicas,"SELECT recetasMedicas.id, recetasmedicas.duracion,recetasmedicas.unidades,recetasmedicas.denominacion,recetasmedicas.dosificacion,recetasmedicas.formato,recetasmedicas.via,recetasmedicas.fechaprescripcion,recetasmedicas.diagnostico,recetasmedicas.instrucciones FROM recetasMedicas where id = @id",
354,71,qryc2,"SELECT snombrecli as snombretra, snifcli as sniftra, sdomiciliocli as sdomiciliotra, spoblacioncli as spoblaciontra, numcolegiado, especialidad FROM clientes c2 WHERE c2.codsubusu = @icodsubusu and tipobd=1",
354,72,qryrecetasxml,"SELECT numerolote, numero as numreceta, cve from recetasXML where id = @id_xml",
355,4,qryclientes,"SELECT clientes.snombrecli,clientes.snifcli FROM clientes WHERE icodcli = @icodcli",
355,37,qrysubusu,SELECT subusu.nombre FROM subusu WHERE icodsubusu = @icodsubusu,
355,70,qryrecetasmedicas,"SELECT recetasMedicas.id, recetasmedicas.duracion,recetasmedicas.unidades,recetasmedicas.denominacion,recetasmedicas.dosificacion,recetasmedicas.formato,recetasmedicas.via,recetasmedicas.fechaprescripcion,recetasmedicas.diagnostico,recetasmedicas.instrucciones FROM recetasMedicas where id = @id",
355,71,qryc2,"SELECT snombrecli as snombretra, snifcli as sniftra, sdomiciliocli as sdomiciliotra, spoblacioncli as spoblaciontra, numcolegiado, especialidad FROM clientes c2 WHERE c2.codsubusu = @icodsubusu and tipobd=1",
355,72,qryrecetasxml,"SELECT numerolote, numero as numreceta, cve from recetasXML where id = @id_xml",
356,4,qryclientes,"SELECT clientes.snombrecli,clientes.snifcli FROM clientes WHERE icodcli = @icodcli",
356,37,qrysubusu,SELECT subusu.nombre FROM subusu WHERE icodsubusu = @icodsubusu,
356,70,qryrecetasmedicas,"SELECT recetasMedicas.id, recetasmedicas.duracion,recetasmedicas.unidades,recetasmedicas.denominacion,recetasmedicas.dosificacion,recetasmedicas.formato,recetasmedicas.via,recetasmedicas.fechaprescripcion,recetasmedicas.diagnostico,recetasmedicas.instrucciones FROM recetasMedicas where id = @id",
356,71,qryc2,"SELECT snombrecli as snombretra, snifcli as sniftra, sdomiciliocli as sdomiciliotra, spoblacioncli as spoblaciontra, numcolegiado, especialidad FROM clientes c2 WHERE c2.codsubusu = @icodsubusu and tipobd=1",
356,72,qryrecetasxml,"SELECT numerolote, numero as numreceta, cve from recetasXML where id = @id_xml",
357,4,qryclientes,"SELECT clientes.snombrecli,clientes.snifcli FROM clientes WHERE icodcli = @icodcli",
357,37,qrysubusu,SELECT subusu.nombre FROM subusu WHERE icodsubusu = @icodsubusu,
357,70,qryrecetasmedicas,"SELECT recetasMedicas.id, recetasmedicas.duracion,recetasmedicas.unidades,recetasmedicas.denominacion,recetasmedicas.dosificacion,recetasmedicas.formato,recetasmedicas.via,recetasmedicas.fechaprescripcion,recetasmedicas.diagnostico,recetasmedicas.instrucciones FROM recetasMedicas where id = @id",
357,71,qryc2,"SELECT snombrecli as snombretra, snifcli as sniftra, sdomiciliocli as sdomiciliotra, spoblacioncli as spoblaciontra, numcolegiado, especialidad FROM clientes c2 WHERE c2.codsubusu = @icodsubusu and tipobd=1",
357,72,qryrecetasxml,"SELECT numerolote, numero as numreceta, cve from recetasXML where id = @id_xml",
359,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
359,4,qrycli,"select clientes.snombrecli,clientes.snifcli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
359,35,qryseg,"select null, segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero,
CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo, isnull(coleg.numcolegiado,'') as numcolegusuact  , ecita.descripcion as estadosalaespera  from segcli left join subusu on segcli.subusu=subusu.icodsubusu
left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1
left join clientes on st.icodtercero=clientes.icodcli
left join vlistadobonos on vlistadobonos.id = segcli.idbono
left join clientes coleg on segcli.subusu =coleg.codsubusu and coleg.tipobd=1  left join estadosCita ecita on ecita.id=segcli.idEstadoCita where segcli.icodcli = @icodcli and tipoactu <> 'Aviso' order by segcli.dfechaact,segcli.horainiact",
360,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
360,4,qrycli,"select clientes.snombrecli,clientes.snifcli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
360,35,qryseg,"select null, segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero,
CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo, isnull(coleg.numcolegiado,'') as numcolegusuact  , ecita.descripcion as estadosalaespera  from segcli left join subusu on segcli.subusu=subusu.icodsubusu
left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1
left join clientes on st.icodtercero=clientes.icodcli
left join vlistadobonos on vlistadobonos.id = segcli.idbono
left join clientes coleg on segcli.subusu =coleg.codsubusu and coleg.tipobd=1  left join estadosCita ecita on ecita.id=segcli.idEstadoCita where segcli.icodcli = @icodcli and tipoactu <> 'Aviso' order by segcli.dfechaact,segcli.horainiact",
361,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
361,4,qrycli,"select clientes.snombrecli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
361,35,qryseg,"select segcli.sactuacion, segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero,
CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo, isnull(coleg.numcolegiado,'') as numcolegusuact  , ecita.descripcion as estadosalaespera  from segcli left join subusu on segcli.subusu=subusu.icodsubusu
left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1
left join clientes on st.icodtercero=clientes.icodcli
left join vlistadobonos on vlistadobonos.id = segcli.idbono
left join clientes coleg on segcli.subusu =coleg.codsubusu and coleg.tipobd=1  left join estadosCita ecita on ecita.id=segcli.idEstadoCita where segcli.icodcli = @icodcli and tipoactu <> 'Aviso' order by segcli.dfechaact,segcli.horainiact",
362,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
362,4,qrycli,"select clientes.snombrecli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
362,35,qryseg,"select segcli.sactuacion, segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero,
CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo, isnull(coleg.numcolegiado,'') as numcolegusuact  , ecita.descripcion as estadosalaespera  from segcli left join subusu on segcli.subusu=subusu.icodsubusu
left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1
left join clientes on st.icodtercero=clientes.icodcli
left join vlistadobonos on vlistadobonos.id = segcli.idbono
left join clientes coleg on segcli.subusu =coleg.codsubusu and coleg.tipobd=1  left join estadosCita ecita on ecita.id=segcli.idEstadoCita where segcli.icodcli = @icodcli and tipoactu <> 'Aviso' order by segcli.dfechaact,segcli.horainiact",
363,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
363,4,qrycli,"select clientes.snombrecli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
363,35,qryseg,"select segcli.sactuacion, segcli.icodcli,segcli.dfechaact,segcli.linea,subusu.nombre as usuario, clientes.snombrecli as tercero,
CONVERT(VARCHAR, horainiact, 108) as horainiact,CONVERT(VARCHAR, horafinact, 108) as horafinact,convert(char(8), dateadd(second, segcli.tiempo, ''), 114) as tiempo, isnull(coleg.numcolegiado,'') as numcolegusuact  , ecita.descripcion as estadosalaespera  from segcli left join subusu on segcli.subusu=subusu.icodsubusu
left join segcliterceros st on segcli.icodcli=st.icodcli and segcli.dfechaact=st.dfechaact and segcli.linea=st.linea and st.principal=1
left join clientes on st.icodtercero=clientes.icodcli
left join vlistadobonos on vlistadobonos.id = segcli.idbono
left join clientes coleg on segcli.subusu =coleg.codsubusu and coleg.tipobd=1  left join estadosCita ecita on ecita.id=segcli.idEstadoCita where segcli.icodcli = @icodcli and tipoactu <> 'Aviso' order by segcli.dfechaact,segcli.horainiact",
364,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
364,4,qrycli,"select clientes.snombrecli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
365,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
365,4,qrycli,"select clientes.snombrecli,clientes.snifcli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
366,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
366,4,qrycli,"select clientes.snombrecli,clientes.snifcli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
367,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
367,4,qrycli,"select clientes.snombrecli, convert(char(8), dateadd(second, tiempo, ''), 114) as tiempo,(substring(cuentabanco,1,4) + '************' + substring(cuentabanco,17,4)) as cuentabancocifr,
(substring(iban,1,8) + replicate('*',LEN(iban)-8)) as ibancifr, clientes.icodcli from clientes 
where clientes.icodcli = @icodcli
",
368,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
368,4,qryclientes,"SELECT clientes.snombrecli,clientes.snifcli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.email,clientes.pagweb FROM clientes where icodcli = @icodcli",
369,1,qrydirector,"select *,cast(datepart(dd,getdate()) as varchar) + '/' + cast(datepart(mm,getdate()) as varchar) + '/' + cast(datepart(yyyy,getdate()) as varchar) as fechaimpresion,
(datename(day,getdate()) + ' de ' + lower(datename(month, getdate())) + ' de ' + datename(year,getdate())) as fechaimpresionlarga from director where icodprocu = @icodprocu",
369,4,qryclientes,"SELECT clientes.snombrecli,clientes.snifcli,clientes.stelefonocli,clientes.telefono2,clientes.smovilcli,clientes.email,clientes.pagweb FROM clientes where icodcli = @icodcli",
